const __vite__fileDeps=["assets/index-BcZxoa4C.js","assets/react-core-CLwr57uy.js","assets/semi-ui-BHzOf8tD.js","assets/semi-ui-DPNiGiI-.css","assets/tools-Bia2vmZV.js","assets/react-components-B0-Ya59j.js","assets/semantic-7HezVohW.js","assets/index-B3gkVdNw.js","assets/visactor-gtn3WK9d.js","assets/index-DQO7dzHP.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as t,a as yt,u as Me,N as Dt,L as iu,R as du,e as Ou,c as Bt,g as At,f as bt,h as St,i as wt,j as pe,B as vt}from"./react-core-CLwr57uy.js";import{S as De,T as Te,e as L,f as hu,g as eu,h as de,B as T,F as se,i as Z,j as Ie,D as yu,M as fe,k as N,l as uu,m as Pe,P as we,L as ie,I as Xu,C as be,n as su,o as kt,R as ge,p as ce,q as Ue,r as Tu,A as zu,s as Ke,t as _t,u as Tt,v as It,w as vu,x as fu,y as Iu,z as et,E as He,G as ut,H as Pt,J as Pu,K as lu,N as Wu,O as Mt,Q as tt,U as nt,V as $t,W as Rt,X as Ze,Y as st,Z as at,$ as Ot,a0 as zt,a1 as Lt,a2 as Nt,a3 as Wt,a4 as Ut,a5 as Kt,a6 as Gt,a7 as Ht,a8 as qt}from"./semi-ui-BHzOf8tD.js";import{c as Vt,a as rt}from"./tools-Bia2vmZV.js";import{Q as Qt,_ as ru,T as it,f as ku,k as Jt}from"./react-components-B0-Ya59j.js";import{G as qe,H as je,I as Lu,F as U,S as Au,B as Xe,M as Du,D as Se,a as xu,b as Yt,L as Zt}from"./semantic-7HezVohW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();var lt={exports:{}},bu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt=t,en=Symbol.for("react.element"),un=Symbol.for("react.fragment"),tn=Object.prototype.hasOwnProperty,nn=Xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sn={key:!0,ref:!0,__self:!0,__source:!0};function ot(u,n,o){var s,i={},a=null,p=null;o!==void 0&&(a=""+o),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(p=n.ref);for(s in n)tn.call(n,s)&&!sn.hasOwnProperty(s)&&(i[s]=n[s]);if(u&&u.defaultProps)for(s in n=u.defaultProps,n)i[s]===void 0&&(i[s]=n[s]);return{$$typeof:en,type:u,key:a,ref:p,props:i,_owner:nn.current}}bu.Fragment=un;bu.jsx=ot;bu.jsxs=ot;lt.exports=bu;var e=lt.exports,Mu={},Uu=yt;Mu.createRoot=Uu.createRoot,Mu.hydrateRoot=Uu.hydrateRoot;const an="modulepreload",rn=function(u){return"/"+u},Ku={},Nu=function(n,o,s){let i=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),p=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.all(o.map(A=>{if(A=rn(A),A in Ku)return;Ku[A]=!0;const v=A.endsWith(".css"),F=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${F}`))return;const c=document.createElement("link");if(c.rel=v?"stylesheet":an,v||(c.as="script",c.crossOrigin=""),c.href=A,p&&c.setAttribute("nonce",p),document.head.appendChild(c),v)return new Promise((m,C)=>{c.addEventListener("load",m),c.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${A}`)))})}))}return i.then(()=>n()).catch(a=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=a,window.dispatchEvent(p),!p.defaultPrevented)throw a})},ye=({prompt:u="page"})=>e.jsxs(De,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),ln=Vt(),he=10,ju=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:33,text:"AWS Claude",value:33,color:"indigo",label:"AWS Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:34,text:"Cohere",value:34,color:"purple",label:"Cohere"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:26,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:25,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:35,text:"MiniMax",value:35,color:"green",label:"MiniMax"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],on=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function ke(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function ct(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function Su(){let u=localStorage.getItem("system_name");return u||"New API"}function Fu(){let u=localStorage.getItem("logo");return u||"/logo.png"}function cn(){return localStorage.getItem("footer_html")}async function ze(u){let n=!0;try{await navigator.clipboard.writeText(u)}catch(o){n=!1,console.error(o)}return n}function ve(){return window.innerWidth<=600}let dt={autoClose:!1};ve()&&(dt.position="top-center");function y(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:Te.error("错误：请求次数过多，请稍后再试！");break;case 500:Te.error("错误：服务器内部错误，请联系管理员！");break;case 405:Te.info("本站仅作演示之用，无服务端！");break;default:Te.error("错误："+u.message)}return}Te.error("错误："+u.message)}else Te.error("错误："+u)}function Ve(u){Te.warning(u)}function Q(u){Te.success(u)}function Be(u){Te.info(u)}function Gu(u,n=!1){n?Qt(e.jsx(on,{htmlContent:u}),dt):Te.info(u)}function Eu(u){return u.endsWith("/")?u.slice(0,-1):u}function Le(u){let n=new Date(u*1e3),o=n.getFullYear().toString(),s=(n.getMonth()+1).toString(),i=n.getDate().toString(),a=n.getHours().toString(),p=n.getMinutes().toString(),A=n.getSeconds().toString();return s.length===1&&(s="0"+s),i.length===1&&(i="0"+i),a.length===1&&(a="0"+a),p.length===1&&(p="0"+p),A.length===1&&(A="0"+A),o+"-"+s+"-"+i+" "+a+":"+p+":"+A}function Qs(u,n="hour"){let o=new Date(u*1e3),s=(o.getMonth()+1).toString(),i=o.getDate().toString(),a=o.getHours().toString();s.length===1&&(s="0"+s),i.length===1&&(i="0"+i),a.length===1&&(a="0"+a);let p=s+"-"+i;if(n==="hour")p+=" "+a+":00";else if(n==="week"){let A=new Date(u*1e3+5184e5),v=(A.getMonth()+1).toString(),F=A.getDate().toString();v.length===1&&(v="0"+v),F.length===1&&(F="0"+F),p+=" - "+v+"-"+F}return p}function dn(u,n){let o=new Blob([u],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=n,i.click()}const au=u=>{try{JSON.parse(u)}catch{return!1}return!0};function hn(u){return!localStorage.getItem(`prompt-${u}`)}function Qe(u,n){const o=[];for(const s in u)u.hasOwnProperty(s)&&n.hasOwnProperty(s)&&u[s]!==n[s]&&o.push({key:s,oldValue:u[s],newValue:n[s]});return o}var Hu={VITE_REACT_APP_VERSION:"",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const M=rt.create({baseURL:Hu.VITE_REACT_APP_SERVER_URL?Hu.VITE_REACT_APP_SERVER_URL:""});M.interceptors.response.use(u=>u,u=>{y(u)});function ht(u){if(u==="")return e.jsx(L,{size:"large",children:"unknown"},"default");const n={vip:"yellow",pro:"yellow",svip:"red",premium:"red"},o=u.split(",").sort();return e.jsx("span",{children:o.map(s=>e.jsx(L,{size:"large",color:n[s]||cu(s),children:s},s))},u)}function Bu(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function Js(u,n=2){let o=localStorage.getItem("display_in_currency");return u=u.toFixed(n),o?"$"+u:u}function Fn(u){if(u=u.toFixed(2),u>=1e5){let n=u.toString(),o=n.indexOf("."),s=n,i="";return o!==-1&&(s=n.slice(0,o),i=n.slice(o)),s.slice(0,2)+".."+s.slice(-2)+i}return u}function Cu(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function pn(u){let n=localStorage.getItem("quota_per_unit");return n=parseFloat(n),u=parseFloat(u),n*u}function Ys(u,n=6){let o=localStorage.getItem("quota_per_unit");return o=parseFloat(o),(u/o).toFixed(n)}function mn(u){let n=localStorage.getItem("display_in_currency");return n=n==="true",n?"$"+u:pn(u)}function me(u,n=2){let o=localStorage.getItem("quota_per_unit"),s=localStorage.getItem("display_in_currency");return o=parseFloat(o),s=s==="true",s?"$"+(u/o).toFixed(n):Bu(u)}function gn(u,n,o,s=-1,i,a){if(s!==-1)return"模型价格：$"+s*a;{i===void 0&&(i=0);let p=o*2*a,A=o*2*i*a,v=u/1e6*p+n/1e6*A;return e.jsx(e.Fragment,{children:e.jsxs("article",{children:[e.jsxs("p",{children:["提示 $",p," / 1M tokens"]}),e.jsxs("p",{children:["补全 $",A," / 1M tokens"]}),e.jsx("p",{}),e.jsxs("p",{children:["提示 ",u," tokens / 1M tokens * $",p," + 补全"," ",n," tokens / 1M tokens * $",A," = $",v.toFixed(6)]})]})})}}function ou(u,n){let o=localStorage.getItem("display_in_currency");return o=o==="true",o?`（等价金额：${me(u,n)}）`:""}const qu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],Zs={"dall-e":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(149,252,206)","gpt-3.5-turbo-16k-0613":"rgb(119,255,214)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)","claude-3-opus-20240229":"rgb(255,132,31)","claude-3-sonnet-20240229":"rgb(253,135,93)","claude-3-haiku-20240307":"rgb(255,175,146)","claude-2.1":"rgb(255,209,190)"};function cu(u){let n=0;for(let s=0;s<u.length;s++)n+=u.charCodeAt(s);let o=n%qu.length;return qu[o]}const xn=u=>{const n={username:"",display_name:"",password:""},[o,s]=t.useState(n),[i,a]=t.useState(!1),{username:p,display_name:A,password:v}=o,F=(C,g)=>{s(I=>({...I,[C]:g}))},c=async()=>{if(a(!0),o.username===""||o.password==="")return;const C=await M.post("/api/user/",o),{success:g,message:I}=C.data;g?(Q("用户账户创建成功！"),s(n),u.refresh(),u.handleClose()):y(I),a(!1)},m=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:"left",title:e.jsx(eu,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:c,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:m,children:"取消"})]})}),closeIcon:null,onCancel:()=>m(),width:ve()?"100%":600,children:e.jsxs(De,{spinning:i,children:[e.jsx(se,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:C=>F("username",C),value:p,autoComplete:"off"}),e.jsx(se,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:C=>F("display_name",C),value:A}),e.jsx(se,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:C=>F("password",C),value:v,autoComplete:"off"})]})})})},$u=u=>{const n=u.editingUser.id,[o,s]=t.useState(!0),[i,a]=t.useState(!1),[p,A]=t.useState(""),[v,F]=t.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[c,m]=t.useState([]),{username:C,display_name:g,password:I,github_id:P,wechat_id:z,telegram_id:k,email:K,quota:G,group:Y}=v,V=(E,$)=>{F(f=>({...f,[E]:$}))},q=async()=>{try{let E=await M.get("/api/group/");m(E.data.data.map($=>({label:$,value:$})))}catch(E){y(E.message)}};Me();const X=()=>{u.handleClose()},te=async()=>{s(!0);let E;n?E=await M.get(`/api/user/${n}`):E=await M.get("/api/user/self");const{success:$,message:f,data:b}=E.data;$?(b.password="",F(b)):y(f),s(!1)};t.useEffect(()=>{te().then(),n&&q().then()},[u.editingUser.id]);const ue=async()=>{s(!0);let E;if(n){let b={...v,id:parseInt(n)};typeof b.quota=="string"&&(b.quota=parseInt(b.quota)),E=await M.put("/api/user/",b)}else E=await M.put("/api/user/self",v);const{success:$,message:f}=E.data;$?(Q("用户信息更新成功！"),u.refresh(),u.handleClose()):y(f),s(!1)},S=()=>{let E=parseInt(G)+parseInt(p);F($=>({...$,quota:E}))},d=()=>{A("0"),a(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(hu,{placement:"right",title:e.jsx(eu,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:ue,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:X,children:"取消"})]})}),closeIcon:null,onCancel:()=>X(),width:ve()?"100%":600,children:e.jsxs(De,{spinning:o,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"用户名"})}),e.jsx(se,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:E=>V("username",E),value:C,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"密码"})}),e.jsx(se,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:E=>V("password",E),value:I,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"显示名称"})}),e.jsx(se,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:E=>V("display_name",E),value:g,autoComplete:"new-password"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"分组"})}),e.jsx(Ie,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:E=>V("group",E),value:v.group,autoComplete:"new-password",optionList:c}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:`剩余额度${ou(G)}`})}),e.jsxs(de,{children:[e.jsx(se,{name:"quota",placeholder:"请输入新的剩余额度",onChange:E=>V("quota",E),value:G,type:"number",autoComplete:"new-password"}),e.jsx(T,{onClick:d,children:"添加额度"})]})]}),e.jsx(yu,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(se,{name:"github_id",value:P,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"已绑定的微信账户"})}),e.jsx(se,{name:"wechat_id",value:z,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"已绑定的邮箱账户"})}),e.jsx(se,{name:"email",value:K,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"已绑定的Telegram账户"})}),e.jsx(se,{name:"telegram_id",value:k,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})}),e.jsxs(fe,{centered:!0,visible:i,onOk:()=>{S(),a(!1)},onCancel:()=>a(!1),closable:null,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:`新额度${me(G)} + ${me(p)} = ${me(G+parseInt(p))}`})}),e.jsx(se,{name:"addQuotaLocal",placeholder:"需要添加的额度（支持负数）",onChange:E=>{A(E)},value:p,type:"number",autoComplete:"new-password"})]})]})};function En(u){switch(u){case 1:return e.jsx(L,{size:"large",children:"普通用户"});case 10:return e.jsx(L,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx(L,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx(L,{color:"red",size:"large",children:"未知身份"})}}const Cn=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(r,x,j)=>e.jsx("div",{children:ht(r)})},{title:"统计信息",dataIndex:"info",render:(r,x,j)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Pe,{content:"剩余额度",children:e.jsx(L,{color:"white",size:"large",children:me(x.quota)})}),e.jsx(Pe,{content:"已用额度",children:e.jsx(L,{color:"white",size:"large",children:me(x.used_quota)})}),e.jsx(Pe,{content:"调用次数",children:e.jsx(L,{color:"white",size:"large",children:Bu(x.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(r,x,j)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Pe,{content:"邀请人数",children:e.jsx(L,{color:"white",size:"large",children:Bu(x.aff_count)})}),e.jsx(Pe,{content:"邀请总收益",children:e.jsx(L,{color:"white",size:"large",children:me(x.aff_history_quota)})}),e.jsx(Pe,{content:"邀请人ID",children:x.inviter_id===0?e.jsx(L,{color:"white",size:"large",children:"无"}):e.jsx(L,{color:"white",size:"large",children:x.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(r,x,j)=>e.jsx("div",{children:En(r)})},{title:"状态",dataIndex:"status",render:(r,x,j)=>e.jsx("div",{children:x.DeletedAt!==null?e.jsx(L,{color:"red",children:"已注销"}):d(r)})},{title:"",dataIndex:"operate",render:(r,x,j)=>e.jsxs("div",{children:[x.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(we,{title:"确定？",okType:"warning",onConfirm:()=>{S(x.username,"promote",x)},children:e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(we,{title:"确定？",okType:"warning",onConfirm:()=>{S(x.username,"demote",x)},children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),x.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{S(x.username,"disable",x)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{S(x.username,"enable",x)},disabled:x.status===3,children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{q(x),Y(!0)},children:"编辑"})]}),e.jsx(we,{title:"确定是否要删除此用户？",content:"硬删除，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{S(x.username,"delete",x).then(()=>{te(x.id)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})})]})}],[n,o]=t.useState([]),[s,i]=t.useState(!0),[a,p]=t.useState(1),[A,v]=t.useState(""),[F,c]=t.useState(!1),[m,C]=t.useState(""),[g,I]=t.useState([]),[P,z]=t.useState(he),[k,K]=t.useState(!1),[G,Y]=t.useState(!1),[V,q]=t.useState({id:void 0}),X=r=>{r.length>=a*he?z(r.length+1):z(r.length)},te=r=>{console.log(r);let x=[...n];if(r!=null){let j=x.findIndex(R=>R.id===r);j>-1&&(x.splice(j,1),o(x))}},ue=async r=>{const x=await M.get(`/api/user/?p=${r}`),{success:j,message:R,data:J}=x.data;if(j)if(r===0)o(J),X(J);else{let B=n;B.push(...J),o(B),X(B)}else y(R);i(!1)};t.useEffect(()=>{ue(0).then().catch(r=>{y(r)}),w().then()},[]);const S=async(r,x,j)=>{const R=await M.post("/api/user/manage",{username:r,action:x}),{success:J,message:B}=R.data;if(J){Q("操作成功完成！");let W=R.data.data,ee=[...n];x==="delete"||(j.status=W.status,j.role=W.role),o(ee)}else y(B)},d=r=>{switch(r){case 1:return e.jsx(L,{size:"large",children:"已激活"});case 2:return e.jsx(L,{size:"large",color:"red",children:"已封禁"});default:return e.jsx(L,{size:"large",color:"grey",children:"未知状态"})}},E=async(r,x)=>{if(r===""&&x===""){await ue(0),p(1);return}c(!0);const j=await M.get(`/api/user/search?keyword=${r}&group=${x}`),{success:R,message:J,data:B}=j.data;R?(o(B),p(1)):y(J),c(!1)},$=async r=>{v(r.trim())},f=r=>{p(r),r===Math.ceil(n.length/he)+1&&ue(r-1).then(x=>{})},b=n.slice((a-1)*he,a*he),h=()=>{K(!1)},D=()=>{Y(!1),q({id:void 0})},l=async()=>{A===""?await ue(a-1):await E()},w=async()=>{try{let r=await M.get("/api/group/");if(r===void 0)return;I(r.data.data.map(x=>({label:x,value:x})))}catch(r){y(r.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(xn,{refresh:l,visible:k,handleClose:h}),e.jsx($u,{refresh:l,visible:G,handleClose:D,editingUser:V}),e.jsx(N,{onSubmit:()=>{E(A,m)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(N.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:A,loading:F,onChange:r=>$(r)}),e.jsx(N.Select,{field:"group",label:"分组",optionList:g,onChange:r=>{C(r),E(A,r)}}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx(uu,{columns:u,dataSource:b,pagination:{currentPage:a,pageSize:he,total:P,pageSizeOpts:[10,20,50,100],onPageChange:f},loading:s}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{K(!0)},children:"添加用户"})]})},fn=()=>e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(ie.Content,{children:e.jsx(Cn,{})})]})});function We({children:u}){return localStorage.getItem("user")?u:e.jsx(Dt,{to:"/login",state:{from:ln.location}})}const jn=()=>{const[u,n]=t.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:o,password:s,password2:i}=u,[a,p]=t.useState(!1),[A,v]=t.useState(!1),[F,c]=t.useState(""),[m,C]=t.useState(""),[g,I]=t.useState(!1),P=Fu();let z=new URLSearchParams(window.location.search).get("aff");z&&localStorage.setItem("aff",z),t.useEffect(()=>{let V=localStorage.getItem("status");V&&(V=JSON.parse(V),p(V.email_verification),V.turnstile_check&&(v(!0),c(V.turnstile_site_key)))});let k=Me();function K(V){const{name:q,value:X}=V.target;console.log(q,X),n(te=>({...te,[q]:X}))}async function G(V){if(s.length<8){Be("密码长度不得小于 8 位！");return}if(s!==i){Be("两次输入的密码不一致");return}if(o&&s){if(A&&m===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}I(!0),z||(z=localStorage.getItem("aff")),u.aff_code=z;const q=await M.post(`/api/user/register?turnstile=${m}`,u),{success:X,message:te}=q.data;X?(k("/login"),Q("注册成功！")):y(te),I(!1)}}const Y=async()=>{if(u.email==="")return;if(A&&m===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}I(!0);const V=await M.get(`/api/verification?email=${u.email}&turnstile=${m}`),{success:q,message:X}=V.data;q?Q("验证码发送成功，请检查你的邮箱！"):y(X),I(!1)};return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(je,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:P})," 新用户注册"]}),e.jsx(U,{size:"large",children:e.jsxs(Au,{children:[e.jsx(U.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"输入用户名，最长 12 位",onChange:K,name:"username"}),e.jsx(U.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:K,name:"password",type:"password"}),e.jsx(U.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:K,name:"password2",type:"password"}),a?e.jsxs(e.Fragment,{children:[e.jsx(U.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"输入邮箱地址",onChange:K,name:"email",type:"email",action:e.jsx(Xe,{onClick:Y,disabled:g,children:"获取验证码"})}),e.jsx(U.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入验证码",onChange:K,name:"verification_code"})]}):e.jsx(e.Fragment,{}),A?e.jsx(ru,{sitekey:F,onVerify:V=>{C(V)}}):e.jsx(e.Fragment,{}),e.jsx(Xe,{color:"green",fluid:!0,size:"large",onClick:G,loading:g,children:"注册"})]})}),e.jsxs(Du,{children:["已有账户？",e.jsx(iu,{to:"/login",className:"btn btn-link",children:"点击登录"})]})]})})},yn=(u,n)=>{switch(n.type){case"login":return{...u,user:n.payload};case"logout":return{...u,user:void 0};default:return u}},Ft={user:void 0},Je=du.createContext({state:Ft,dispatch:()=>null}),Dn=({children:u})=>{const[n,o]=du.useReducer(yn,Ft);return e.jsx(Je.Provider,{value:[n,o],children:u})};async function Bn(){const u=await M.get("/api/oauth/state"),{success:n,message:o,data:s}=u.data;return n?s:(y(o),"")}async function pt(u){const n=await Bn();n&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${n}&scope=user:email`)}let Ge;async function An(){const u=await M.get("/api/models"),{success:n,data:o}=u.data;n&&(Ge=o,localStorage.setItem("channel_models",JSON.stringify(o)))}function _u(u){if(Ge!==void 0&&u in Ge)return Ge[u]?Ge[u]:[];let n=localStorage.getItem("channel_models");return n?(Ge=JSON.parse(n),u in Ge?Ge[u]:[]):[]}const bn=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(Xu,{svg:e.jsx(u,{})})})};function Sn(u){localStorage.setItem("status",JSON.stringify(u)),localStorage.setItem("system_name",u.system_name),localStorage.setItem("logo",u.logo),localStorage.setItem("footer_html",u.footer_html),localStorage.setItem("quota_per_unit",u.quota_per_unit),localStorage.setItem("display_in_currency",u.display_in_currency),localStorage.setItem("enable_drawing",u.enable_drawing),localStorage.setItem("enable_data_export",u.enable_data_export),localStorage.setItem("data_export_default_time",u.data_export_default_time),localStorage.setItem("default_collapse_sidebar",u.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",u.mj_notify_enabled),u.chat_link?localStorage.setItem("chat_link",u.chat_link):localStorage.removeItem("chat_link"),u.chat_link2?localStorage.setItem("chat_link2",u.chat_link2):localStorage.removeItem("chat_link2")}function wn(u){localStorage.setItem("user",JSON.stringify(u))}const vn=()=>{const[u,n]=t.useState({username:"",password:"",wechat_verification_code:""}),[o,s]=Ou(),[i,a]=t.useState(!1),{username:p,password:A}=u,[v,F]=t.useContext(Je),[c,m]=t.useState(!1),[C,g]=t.useState(""),[I,P]=t.useState("");let z=Me();const[k,K]=t.useState({});Fu(),t.useEffect(()=>{o.get("expired")&&y("未登录或登录已过期，请重新登录！");let S=localStorage.getItem("status");S&&(S=JSON.parse(S),K(S),S.turnstile_check&&(m(!0),g(S.turnstile_site_key)))},[]);const[G,Y]=t.useState(!1),V=()=>{Y(!0)},q=async()=>{if(c&&I===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const S=await M.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:d,message:E,data:$}=S.data;d?(F({type:"login",payload:$}),localStorage.setItem("user",JSON.stringify($)),z("/"),Q("登录成功！"),Y(!1)):y(E)};function X(S,d){n(E=>({...E,[S]:d}))}async function te(S){if(c&&I===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(a(!0),p&&A){const d=await M.post(`/api/user/login?turnstile=${I}`,{username:p,password:A}),{success:E,message:$,data:f}=d.data;E?(F({type:"login",payload:f}),wn(f),Q("登录成功！"),p==="root"&&A==="123456"&&fe.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),z("/token")):y($)}else y("请输入用户名和密码！")}const ue=async S=>{const d=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],E={};d.forEach(D=>{S[D]&&(E[D]=S[D])});const $=await M.get("/api/oauth/telegram/login",{params:E}),{success:f,message:b,data:h}=$.data;f?(F({type:"login",payload:h}),localStorage.setItem("user",JSON.stringify(h)),Q("登录成功！"),z("/")):y(b)};return e.jsx("div",{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{}),e.jsx(ie.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(be,{children:[e.jsx(eu,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(N,{children:[e.jsx(N.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:S=>X("username",S)}),e.jsx(N.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:S=>X("password",S)}),e.jsx(T,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:te,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(su,{children:["没有账号请先 ",e.jsx(iu,{to:"/register",children:"注册账号"})]}),e.jsxs(su,{children:["忘记密码 ",e.jsx(iu,{to:"/reset",children:"点击重置"})]})]}),k.github_oauth||k.wechat_login||k.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(yu,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[k.github_oauth?e.jsx(T,{type:"primary",icon:e.jsx(kt,{}),onClick:()=>pt(k.github_client_id)}):e.jsx(e.Fragment,{}),k.wechat_login?e.jsx(T,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(Xu,{svg:e.jsx(bn,{})}),onClick:V}):e.jsx(e.Fragment,{})]}),k.telegram_oauth?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:5},children:e.jsx(it,{dataOnauth:ue,botName:k.telegram_bot_name})})}):e.jsx(e.Fragment,{})]}):e.jsx(e.Fragment,{}),e.jsxs(fe,{title:"微信扫码登录",visible:G,maskClosable:!0,onOk:q,onCancel:()=>Y(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:k.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(N,{size:"large",children:e.jsx(N.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:S=>X("wechat_verification_code",S)})})]})]}),c?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(ru,{sitekey:C,onVerify:S=>{P(S)}})}):e.jsx(e.Fragment,{})]})})})]})})},kn=()=>e.jsx(e.Fragment,{children:e.jsxs(Du,{negative:!0,children:[e.jsx(Du.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),mt=t.createContext(null),gt=()=>t.useContext(mt),xt=t.createContext(null),_n=()=>t.useContext(xt),Tn=({children:u})=>{const[n,o]=t.useState(()=>{try{return localStorage.getItem("theme-mode")||null}catch{return null}}),s=t.useCallback(i=>{o(i?"dark":"light");const a=document.body;i?(a.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(a.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light"))},[]);return e.jsx(xt.Provider,{value:s,children:e.jsx(mt.Provider,{value:n,children:u})})},In=()=>{let[u,n]=t.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",WorkerUrl:"",WorkerValidKey:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",EmailAliasRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[o,s]=t.useState({});let[i,a]=t.useState(!1);const[p,A]=t.useState([]),[v,F]=t.useState(""),[c,m]=t.useState(!1),g=gt()==="dark",I=async()=>{const d=await M.get("/api/option/"),{success:E,message:$,data:f}=d.data;if(E){let b={};f.forEach(h=>{h.key==="TopupGroupRatio"&&(h.value=JSON.stringify(JSON.parse(h.value),null,2)),b[h.key]=h.value}),n({...b,EmailDomainWhitelist:b.EmailDomainWhitelist.split(",")}),s(b),A(b.EmailDomainWhitelist.split(",").map(h=>({key:h,text:h,value:h})))}else y($)};t.useEffect(()=>{I().then()},[]),t.useEffect(()=>{},[u.EmailDomainWhitelist]);const P=async(d,E)=>{switch(a(!0),d){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"EmailAliasRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":E=u[d]==="true"?"false":"true";break}const $=await M.put("/api/option/",{key:d,value:E}),{success:f,message:b}=$.data;f?(d==="EmailDomainWhitelist"&&(E=E.split(",")),d==="Price"&&(E=parseFloat(E)),n(h=>({...h,[d]:E}))):y(b),a(!1)},z=async(d,{name:E,value:$})=>{if(E==="PasswordLoginEnabled"&&u[E]==="true"){m(!0);return}E==="Notice"||E.startsWith("SMTP")&&E!=="SMTPSSLEnabled"||E==="ServerAddress"||E==="WorkerUrl"||E==="WorkerValidKey"||E==="EpayId"||E==="EpayKey"||E==="Price"||E==="PayAddress"||E==="GitHubClientId"||E==="GitHubClientSecret"||E==="WeChatServerAddress"||E==="WeChatServerToken"||E==="WeChatAccountQRCodeImageURL"||E==="TurnstileSiteKey"||E==="TurnstileSecretKey"||E==="EmailDomainWhitelist"||E==="TopupGroupRatio"||E==="TelegramBotToken"||E==="TelegramBotName"?n(f=>({...f,[E]:$})):await P(E,$)},k=async()=>{let d=Eu(u.ServerAddress);await P("ServerAddress",d)},K=async()=>{let d=Eu(u.WorkerUrl);await P("WorkerUrl",d),u.WorkerValidKey!==""&&await P("WorkerValidKey",u.WorkerValidKey)},G=async()=>{if(u.ServerAddress===""){y("请先填写服务器地址");return}if(o.TopupGroupRatio!==u.TopupGroupRatio){if(!au(u.TopupGroupRatio)){y("充值分组倍率不是合法的 JSON 字符串");return}await P("TopupGroupRatio",u.TopupGroupRatio)}let d=Eu(u.PayAddress);await P("PayAddress",d),u.EpayId!==""&&await P("EpayId",u.EpayId),u.EpayKey!==void 0&&u.EpayKey!==""&&await P("EpayKey",u.EpayKey),await P("Price",""+u.Price)},Y=async()=>{o.SMTPServer!==u.SMTPServer&&await P("SMTPServer",u.SMTPServer),o.SMTPAccount!==u.SMTPAccount&&await P("SMTPAccount",u.SMTPAccount),o.SMTPFrom!==u.SMTPFrom&&await P("SMTPFrom",u.SMTPFrom),o.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await P("SMTPPort",u.SMTPPort),o.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await P("SMTPToken",u.SMTPToken)},V=async()=>{o.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await P("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},q=async()=>{o.WeChatServerAddress!==u.WeChatServerAddress&&await P("WeChatServerAddress",Eu(u.WeChatServerAddress)),o.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await P("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),o.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await P("WeChatServerToken",u.WeChatServerToken)},X=async()=>{o.GitHubClientId!==u.GitHubClientId&&await P("GitHubClientId",u.GitHubClientId),o.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await P("GitHubClientSecret",u.GitHubClientSecret)},te=async()=>{await P("TelegramBotToken",u.TelegramBotToken),await P("TelegramBotName",u.TelegramBotName)},ue=async()=>{o.TurnstileSiteKey!==u.TurnstileSiteKey&&await P("TurnstileSiteKey",u.TurnstileSiteKey),o.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await P("TurnstileSecretKey",u.TurnstileSecretKey)},S=()=>{const d=u.EmailDomainWhitelist;v!==""&&!d.includes(v)&&(F(""),n({...u,EmailDomainWhitelist:[...d,v]}),A([...p,{key:v,text:v,value:v}]))};return e.jsx(qe,{columns:1,children:e.jsx(qe.Column,{children:e.jsxs(U,{loading:i,inverted:g,children:[e.jsx(je,{as:"h3",inverted:g,children:"通用设置"}),e.jsx(U.Group,{widths:"equal",children:e.jsx(U.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:z})}),e.jsx(U.Button,{onClick:k,children:"更新服务器地址"}),e.jsxs(je,{as:"h3",inverted:g,children:["代理设置（支持 ",e.jsx("a",{href:"https://github.com/Calcium-Ion/new-api-worker",target:"_blank",rel:"noreferrer",children:"new-api-worker"}),"）"]}),e.jsxs(U.Group,{widths:"equal",children:[e.jsx(U.Input,{label:"Worker地址，不填写则不启用代理",placeholder:"例如：https://workername.yourdomain.workers.dev",value:u.WorkerUrl,name:"WorkerUrl",onChange:z}),e.jsx(U.Input,{label:"Worker密钥，根据你部署的 Worker 填写",placeholder:"例如：your_secret_key",value:u.WorkerValidKey,name:"WorkerValidKey",onChange:z})]}),e.jsx(U.Button,{onClick:K,children:"更新Worker设置"}),e.jsx(Se,{}),e.jsx(je,{as:"h3",inverted:g,children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(U.Group,{widths:"equal",children:[e.jsx(U.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:z}),e.jsx(U.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:z}),e.jsx(U.Input,{label:"易支付商户密钥",placeholder:"敏感信息不会发送到前端显示",value:u.EpayKey,name:"EpayKey",onChange:z})]}),e.jsxs(U.Group,{widths:"equal",children:[e.jsx(U.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:z}),e.jsx(U.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:z}),e.jsx(U.Input,{label:"最低充值美元数量（以美金为单位，如果使用额度请自行换算！）",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:z})]}),e.jsx(U.Group,{widths:"equal",children:e.jsx(U.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:z,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(U.Button,{onClick:G,children:"更新支付设置"}),e.jsx(Se,{}),e.jsx(je,{as:"h3",inverted:g,children:"配置登录注册"}),e.jsxs(U.Group,{inline:!0,children:[e.jsx(U.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:z}),c&&e.jsxs(xu,{open:c,onClose:()=>m(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(xu.Header,{children:"警告"}),e.jsx(xu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(xu.Actions,{children:[e.jsx(Xe,{onClick:()=>m(!1),children:"取消"}),e.jsx(Xe,{color:"yellow",onClick:async()=>{m(!1),await P("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(U.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:z}),e.jsx(U.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:z}),e.jsx(U.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:z}),e.jsx(U.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:z}),e.jsx(U.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:z})]}),e.jsxs(U.Group,{inline:!0,children:[e.jsx(U.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:z}),e.jsx(U.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:z})]}),e.jsx(Se,{}),e.jsxs(je,{as:"h3",inverted:g,children:["配置邮箱域名白名单",e.jsx(je.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(U.Group,{widths:3,children:e.jsx(U.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:z,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsx(U.Group,{widths:3,children:e.jsx(U.Checkbox,{label:"启用邮箱别名限制（例如：ab.cd@gmail.com）",name:"EmailAliasRestrictionEnabled",onChange:z,checked:u.EmailAliasRestrictionEnabled==="true"})}),e.jsxs(U.Group,{widths:2,children:[e.jsx(U.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:z,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:p}),e.jsx(U.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(Xe,{type:"button",onClick:()=>{S()},children:"填入"}),onKeyDown:d=>{d.key==="Enter"&&S()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:v,onChange:(d,{value:E})=>{F(E)}})]}),e.jsx(U.Button,{onClick:V,children:"保存邮箱域名白名单设置"}),e.jsx(Se,{}),e.jsxs(je,{as:"h3",inverted:g,children:["配置 SMTP",e.jsx(je.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(U.Group,{widths:3,children:[e.jsx(U.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:z,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(U.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:z,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(U.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:z,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(U.Group,{widths:3,children:[e.jsx(U.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:z,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(U.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:z,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(U.Group,{widths:3,children:e.jsx(U.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:z,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(U.Button,{onClick:Y,children:"保存 SMTP 设置"}),e.jsx(Se,{}),e.jsxs(je,{as:"h3",inverted:g,children:["配置 GitHub OAuth App",e.jsxs(je.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(Du,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(U.Group,{widths:3,children:[e.jsx(U.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:z,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(U.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:z,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(U.Button,{onClick:X,children:"保存 GitHub OAuth 设置"}),e.jsx(Se,{}),e.jsxs(je,{as:"h3",inverted:g,children:["配置 WeChat Server",e.jsxs(je.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(U.Group,{widths:3,children:[e.jsx(U.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:z,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(U.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:z,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(U.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:z,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(U.Button,{onClick:q,children:"保存 WeChat Server 设置"}),e.jsx(Se,{}),e.jsx(je,{as:"h3",inverted:g,children:"配置 Telegram 登录"}),e.jsxs(U.Group,{inline:!0,children:[e.jsx(U.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:z,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(U.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:z,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(U.Button,{onClick:te,children:"保存 Telegram 登录设置"}),e.jsx(Se,{}),e.jsxs(je,{as:"h3",inverted:g,children:["配置 Turnstile",e.jsxs(je.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(U.Group,{widths:3,children:[e.jsx(U.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:z,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(U.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:z,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(U.Button,{onClick:ue,children:"保存 Turnstile 设置"})]})})})},Pn=()=>{let[u,n]=t.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[o,s]=t.useState(!1);t.useState(!1),t.useState({tag_name:"",content:""});const i=async(k,K)=>{s(!0);const G=await M.put("/api/option/",{key:k,value:K}),{success:Y,message:V}=G.data;Y?n(q=>({...q,[k]:K})):y(V),s(!1)},[a,p]=t.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),A=async(k,K)=>{const G=K.target.id;n(Y=>({...Y,[G]:k}))},v=t.useRef(),F=async()=>{try{p(k=>({...k,Notice:!0})),await i("Notice",u.Notice),Q("公告已更新")}catch(k){console.error("公告更新失败",k),y("公告更新失败")}finally{p(k=>({...k,Notice:!1}))}},c=t.useRef(),m=async()=>{try{p(k=>({...k,SystemName:!0})),await i("SystemName",u.SystemName),Q("系统名称已更新")}catch(k){console.error("系统名称更新失败",k),y("系统名称更新失败")}finally{p(k=>({...k,SystemName:!1}))}},C=async()=>{try{p(k=>({...k,Logo:!0})),await i("Logo",u.Logo),Q("Logo 已更新")}catch(k){console.error("Logo 更新失败",k),y("Logo 更新失败")}finally{p(k=>({...k,Logo:!1}))}},g=async k=>{try{p(K=>({...K,HomePageContent:!0})),await i(k,u[k]),Q("首页内容已更新")}catch(K){console.error("首页内容更新失败",K),y("首页内容更新失败")}finally{p(K=>({...K,HomePageContent:!1}))}},I=async()=>{try{p(k=>({...k,About:!0})),await i("About",u.About),Q("关于内容已更新")}catch(k){console.error("关于内容更新失败",k),y("关于内容更新失败")}finally{p(k=>({...k,About:!1}))}},P=async()=>{try{p(k=>({...k,Footer:!0})),await i("Footer",u.Footer),Q("页脚内容已更新")}catch(k){console.error("页脚内容更新失败",k),y("页脚内容更新失败")}finally{p(k=>({...k,Footer:!1}))}},z=async()=>{const k=await M.get("/api/option/"),{success:K,message:G,data:Y}=k.data;if(K){let V={};Y.forEach(q=>{q.key in u&&(V[q.key]=q.value)}),n(V),v.current.setValues(V),c.current.setValues(V)}else y(G)};return t.useEffect(()=>{z()},[]),e.jsx(ge,{children:e.jsxs(ce,{span:24,children:[e.jsx(N,{values:u,getFormApi:k=>v.current=k,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"通用设置",children:[e.jsx(N.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:A,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:F,loading:a.Notice,children:"设置公告"})]})}),e.jsx(N,{values:u,getFormApi:k=>c.current=k,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"个性化设置",children:[e.jsx(N.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:A}),e.jsx(T,{onClick:m,loading:a.SystemName,children:"设置系统名称"}),e.jsx(N.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:A}),e.jsx(T,{onClick:C,loading:a.Logo,children:"设置 Logo"}),e.jsx(N.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:A,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:()=>g("HomePageContent"),loading:a.HomePageContent,children:"设置首页内容"}),e.jsx(N.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:A,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:I,loading:a.About,children:"设置关于"}),e.jsx(Ue,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(N.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:A}),e.jsx(T,{onClick:P,loading:a.Footer,children:"设置页脚"})]})})]})})},Mn=()=>{var pu,mu,_,O,ne,re,Fe,Ce,Oe,Ye,gu;const[u,n]=t.useContext(Je);let o=Me();const[s,i]=t.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[a,p]=t.useState({}),[A,v]=t.useState(!1),[F,c]=t.useState(!1),[m,C]=t.useState(!1),[g,I]=t.useState(!1),[P,z]=t.useState(!1),[k,K]=t.useState(""),[G,Y]=t.useState(""),[V,q]=t.useState(!1),[X,te]=t.useState(!1),[ue,S]=t.useState(30),[d,E]=t.useState(""),[$,f]=t.useState(""),[b,h]=t.useState([]),[D,l]=t.useState(!1),[w,r]=t.useState(0);t.useEffect(()=>{let H=localStorage.getItem("status");H&&(H=JSON.parse(H),p(H),H.turnstile_check&&(z(!0),K(H.turnstile_site_key))),J().then(xe=>{console.log(u)}),B().then(),R().then(),r(Cu())},[]),t.useEffect(()=>{let H=null;return X&&ue>0?H=setInterval(()=>{S(ue-1)},1e3):ue===0&&(te(!1),S(30)),()=>clearInterval(H)},[X,ue]);const x=(H,xe)=>{i(Ee=>({...Ee,[H]:xe}))},j=async()=>{const H=await M.get("/api/user/token"),{success:xe,message:Ee,data:Ne}=H.data;xe?(f(Ne),await ze(Ne),Q("令牌已重置并已复制到剪贴板")):y(Ee)},R=async()=>{const H=await M.get("/api/user/aff"),{success:xe,message:Ee,data:Ne}=H.data;if(xe){let jt=`${window.location.origin}/register?aff=${Ne}`;E(jt)}else y(Ee)},J=async()=>{let H=await M.get("/api/user/self");const{success:xe,message:Ee,data:Ne}=H.data;xe?n({type:"login",payload:Ne}):y(Ee)},B=async()=>{let H=await M.get("/api/user/models");const{success:xe,message:Ee,data:Ne}=H.data;xe?(h(Ne),console.log(Ne)):y(Ee)},W=async H=>{H.target.select(),await ze(H.target.value),Q("邀请链接已复制到剪切板")},ee=async H=>{H.target.select(),await ze(H.target.value),Q("系统令牌已复制到剪切板")},le=async()=>{if(s.self_account_deletion_confirmation!==u.user.username){y("请输入你的账户名以确认删除！");return}const H=await M.delete("/api/user/self"),{success:xe,message:Ee}=H.data;xe?(Q("账户已删除！"),await M.get("/api/user/logout"),n({type:"logout"}),localStorage.removeItem("user"),o("/login")):y(Ee)},ae=async()=>{if(s.wechat_verification_code==="")return;const H=await M.get(`/api/oauth/wechat/bind?code=${s.wechat_verification_code}`),{success:xe,message:Ee}=H.data;xe?(Q("微信账户绑定成功！"),c(!1)):y(Ee)},oe=async()=>{if(s.set_new_password!==s.set_new_password_confirmation){y("两次输入的密码不一致！");return}const H=await M.put("/api/user/self",{password:s.set_new_password}),{success:xe,message:Ee}=H.data;xe?(Q("密码修改成功！"),c(!1)):y(Ee),v(!1)},Ae=async()=>{if(w<Cu()){y("划转金额最低为"+me(Cu()));return}const H=await M.post("/api/user/aff_transfer",{quota:w}),{success:xe,message:Ee}=H.data;xe?(Q(Ee),l(!1),J().then()):y(Ee)},_e=async()=>{if(s.email===""){y("请输入邮箱！");return}if(te(!0),P&&G===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}q(!0);const H=await M.get(`/api/verification?email=${s.email}&turnstile=${G}`),{success:xe,message:Ee}=H.data;xe?Q("验证码发送成功，请检查邮箱！"):y(Ee),q(!1)},$e=async()=>{if(s.email_verification_code===""){y("请输入邮箱验证码！");return}q(!0);const H=await M.get(`/api/oauth/email/bind?email=${s.email}&code=${s.email_verification_code}`),{success:xe,message:Ee}=H.data;xe?(Q("邮箱账户绑定成功！"),C(!1),u.user.email=s.email):y(Ee),q(!1)},Re=()=>u.user?u.user.username:"null",tu=()=>{l(!1)},wu=async H=>{await ze(H)?Q("已复制："+H):fe.error({title:"无法复制到剪贴板，请手动复制",content:H})};return e.jsx("div",{children:e.jsx(ie,{children:e.jsxs(ie.Content,{children:[e.jsxs(fe,{title:"请输入要划转的数量",visible:D,onOk:Ae,onCancel:tu,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Z.Text,{children:`可用额度${ou((pu=u==null?void 0:u.user)==null?void 0:pu.aff_quota)}`}),e.jsx(se,{style:{marginTop:5},value:(mu=u==null?void 0:u.user)==null?void 0:mu.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Z.Text,{children:`划转额度${ou(w)} 最低`+me(Cu())}),e.jsx("div",{children:e.jsx(Tu,{min:0,style:{marginTop:5},value:w,onChange:H=>r(H),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(be,{title:e.jsx(be.Meta,{avatar:e.jsx(zu,{size:"default",color:cu(Re()),style:{marginRight:4},children:typeof Re()=="string"&&Re().slice(0,1)}),title:e.jsx(Z.Text,{children:Re()}),description:ct()?e.jsx(L,{color:"red",children:"管理员"}):e.jsx(L,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(de,{vertical:!0,align:"start",children:[e.jsx(L,{color:"green",children:"ID: "+((_=u==null?void 0:u.user)==null?void 0:_.id)}),e.jsx(L,{color:"blue",children:(O=u==null?void 0:u.user)==null?void 0:O.group})]})}),footer:e.jsxs(Ke,{row:!0,children:[e.jsx(Ke.Item,{itemKey:"当前余额",children:me((ne=u==null?void 0:u.user)==null?void 0:ne.quota)}),e.jsx(Ke.Item,{itemKey:"历史消耗",children:me((re=u==null?void 0:u.user)==null?void 0:re.used_quota)}),e.jsx(Ke.Item,{itemKey:"请求次数",children:(Fe=u.user)==null?void 0:Fe.request_count})]}),children:[e.jsx(Z.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(de,{wrap:!0,children:b.map(H=>e.jsx(L,{color:"cyan",onClick:()=>{wu(H)},children:H},H))})})]}),e.jsxs(be,{footer:e.jsxs("div",{children:[e.jsx(Z.Text,{children:"邀请链接"}),e.jsx(se,{style:{marginTop:10},value:d,onClick:W,readOnly:!0})]}),children:[e.jsx(Z.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(Ke,{row:!0,children:[e.jsxs(Ke.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:me((Ce=u==null?void 0:u.user)==null?void 0:Ce.aff_quota)}),e.jsx(T,{type:"secondary",onClick:()=>l(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(Ke.Item,{itemKey:"总收益",children:me((Oe=u==null?void 0:u.user)==null?void 0:Oe.aff_history_quota)}),e.jsx(Ke.Item,{itemKey:"邀请人数",children:(Ye=u==null?void 0:u.user)==null?void 0:Ye.aff_count})]})})]}),e.jsxs(be,{children:[e.jsx(Z.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Z.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{onClick:()=>{C(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Z.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{disabled:u.user&&u.user.wechat_id!==""||!a.wechat_login,children:a.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Z.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{onClick:()=>{pt(a.github_client_id)},disabled:u.user&&u.user.github_id!==""||!a.github_oauth,children:a.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Z.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:a.telegram_oauth?u.user.telegram_id!==""?e.jsx(T,{disabled:!0,children:"已绑定"}):e.jsx(it,{dataAuthUrl:"/api/oauth/telegram/bind",botName:a.telegram_bot_name}):e.jsx(T,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(de,{children:[e.jsx(T,{onClick:j,children:"生成系统访问令牌"}),e.jsx(T,{onClick:()=>{v(!0)},children:"修改密码"}),e.jsx(T,{type:"danger",onClick:()=>{I(!0)},children:"删除个人账户"})]}),$&&e.jsx(se,{readOnly:!0,value:$,onClick:ee,style:{marginTop:"10px"}}),a.wechat_login&&e.jsx(T,{onClick:()=>{c(!0)},children:"绑定微信账号"}),e.jsxs(fe,{onCancel:()=>c(!1),visible:F,size:"small",children:[e.jsx(_t,{src:a.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(se,{placeholder:"验证码",name:"wechat_verification_code",value:s.wechat_verification_code,onChange:H=>x("wechat_verification_code",H)}),e.jsx(T,{color:"",fluid:!0,size:"large",onClick:ae,children:"绑定"})]})]})]}),e.jsxs(fe,{onCancel:()=>C(!1),onOk:$e,visible:m,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(Z.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(se,{fluid:!0,placeholder:"输入邮箱地址",onChange:H=>x("email",H),name:"email",type:"email"}),e.jsx(T,{onClick:_e,disabled:X||V,children:X?`重新发送 (${ue})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(se,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:s.email_verification_code,onChange:H=>x("email_verification_code",H)})}),P?e.jsx(ru,{sitekey:k,onVerify:H=>{Y(H)}}):e.jsx(e.Fragment,{})]}),e.jsxs(fe,{onCancel:()=>I(!1),visible:g,size:"small",centered:!0,onOk:le,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Ue,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{placeholder:`输入你的账户名 ${(gu=u==null?void 0:u.user)==null?void 0:gu.username} 以确认删除`,name:"self_account_deletion_confirmation",value:s.self_account_deletion_confirmation,onChange:H=>x("self_account_deletion_confirmation",H)}),P?e.jsx(ru,{sitekey:k,onVerify:H=>{Y(H)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(fe,{onCancel:()=>v(!1),visible:A,size:"small",centered:!0,onOk:oe,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{name:"set_new_password",placeholder:"新密码",value:s.set_new_password,onChange:H=>x("set_new_password",H)}),e.jsx(se,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:s.set_new_password_confirmation,onChange:H=>x("set_new_password_confirmation",H)}),P?e.jsx(ru,{sitekey:k,onVerify:H=>{Y(H)}}):e.jsx(e.Fragment,{})]})})]})]})})})};function $n(u){const[n,o]=t.useState(!1),[s,i]=t.useState({TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:"",RetryTimes:"",DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,DefaultCollapseSidebar:!1}),a=t.useRef(),[p,A]=t.useState(s);function v(c,m){const C=m.target.id;i(g=>({...g,[C]:c}))}function F(){const c=Qe(s,p);if(!c.length)return Ve("你似乎并没有修改什么");const m=c.map(C=>{let g="";return typeof s[C.key]=="boolean"?g=String(s[C.key]):g=s[C.key],M.put("/api/option/",{key:C.key,value:g})});o(!0),Promise.all(m).then(C=>{if(m.length===1){if(C.includes(void 0))return}else if(m.length>1&&C.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}return t.useEffect(()=>{const c={};for(let m in u.options)Object.keys(s).includes(m)&&(c[m]=u.options[m]);i(c),A(structuredClone(c)),a.current.setValues(c)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:s,getFormApi:c=>a.current=c,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"通用设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Input,{field:"TopUpLink",label:"充值链接",initValue:"",placeholder:"例如发卡网站的购买链接",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(N.Input,{field:"ChatLink",label:"默认聊天页面链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(N.Input,{field:"ChatLink2",label:"聊天页面 2 链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(N.Input,{field:"QuotaPerUnit",label:"单位美元额度",initValue:"",placeholder:"一单位货币能兑换的额度",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(N.Input,{field:"RetryTimes",label:"失败重试次数",initValue:"",placeholder:"失败重试次数",onChange:v,showClear:!0})})]}),e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"DisplayInCurrencyEnabled",label:"以货币形式显示额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:c=>{i({...s,DisplayInCurrencyEnabled:c})}})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"DisplayTokenStatEnabled",label:"Billing 相关 API 显示令牌额度而非用户额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:c=>i({...s,DisplayTokenStatEnabled:c})})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"DefaultCollapseSidebar",label:"默认折叠侧边栏",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:c=>i({...s,DefaultCollapseSidebar:c})})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:F,children:"保存通用设置"})})]})})})})}function Rn(u){const[n,o]=t.useState(!1),[s,i]=t.useState({DrawingEnabled:!1,MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjForwardUrlEnabled:!1,MjModeClearEnabled:!1}),a=t.useRef(),[p,A]=t.useState(s);function v(){const F=Qe(s,p);if(!F.length)return Ve("你似乎并没有修改什么");const c=F.map(m=>{let C="";return typeof s[m.key]=="boolean"?C=String(s[m.key]):C=s[m.key],M.put("/api/option/",{key:m.key,value:C})});o(!0),Promise.all(c).then(m=>{if(c.length===1){if(m.includes(void 0))return}else if(c.length>1&&m.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}return t.useEffect(()=>{const F={};for(let c in u.options)Object.keys(s).includes(c)&&(F[c]=u.options[c]);i(F),A(structuredClone(F)),a.current.setValues(F),localStorage.setItem("mj_notify_enabled",String(s.MjNotifyEnabled))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:s,getFormApi:F=>a.current=F,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"绘图设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"DrawingEnabled",label:"启用绘图功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{i({...s,DrawingEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"MjNotifyEnabled",label:"允许回调（会泄露服务器 IP 地址）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,MjNotifyEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"MjAccountFilterEnabled",label:"允许 AccountFilter 参数",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,MjAccountFilterEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"MjForwardUrlEnabled",label:"开启之后将上游地址替换为服务器地址",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,MjForwardUrlEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"MjModeClearEnabled",label:e.jsxs(e.Fragment,{children:["开启之后会清除用户提示词中的 ",e.jsx(L,{children:"--fast"})," 、",e.jsx(L,{children:"--relax"})," 以及 ",e.jsx(L,{children:"--turbo"})," 参数"]}),size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,MjModeClearEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:v,children:"保存绘图设置"})})]})})})})}function On(u){const[n,o]=t.useState(!1),[s,i]=t.useState({CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,SensitiveWords:""}),a=t.useRef(),[p,A]=t.useState(s);function v(){const F=Qe(s,p);if(!F.length)return Ve("你似乎并没有修改什么");const c=F.map(m=>{let C="";return typeof s[m.key]=="boolean"?C=String(s[m.key]):C=s[m.key],M.put("/api/option/",{key:m.key,value:C})});o(!0),Promise.all(c).then(m=>{if(c.length===1){if(m.includes(void 0))return}else if(c.length>1&&m.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}return t.useEffect(()=>{const F={};for(let c in u.options)Object.keys(s).includes(c)&&(F[c]=u.options[c]);i(F),A(structuredClone(F)),a.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:s,getFormApi:F=>a.current=F,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"屏蔽词过滤设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"CheckSensitiveEnabled",label:"启用屏蔽词过滤功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{i({...s,CheckSensitiveEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"CheckSensitiveOnPromptEnabled",label:"启用 Prompt 检查",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,CheckSensitiveOnPromptEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(ce,{span:16,children:e.jsx(N.TextArea,{label:"屏蔽词列表",extraText:"一行一个屏蔽词，不需要符号分割",placeholder:"一行一个屏蔽词，不需要符号分割",field:"SensitiveWords",onChange:F=>i({...s,SensitiveWords:F}),style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}})})}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:v,children:"保存屏蔽词过滤设置"})})]})})})})}var Et={exports:{}};(function(u,n){(function(o,s){u.exports=s()})(Bt,function(){var o=1e3,s=6e4,i=36e5,a="millisecond",p="second",A="minute",v="hour",F="day",c="week",m="month",C="quarter",g="year",I="date",P="Invalid Date",z=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,k=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,K={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(f){var b=["th","st","nd","rd"],h=f%100;return"["+f+(b[(h-20)%10]||b[h]||b[0])+"]"}},G=function(f,b,h){var D=String(f);return!D||D.length>=b?f:""+Array(b+1-D.length).join(h)+f},Y={s:G,z:function(f){var b=-f.utcOffset(),h=Math.abs(b),D=Math.floor(h/60),l=h%60;return(b<=0?"+":"-")+G(D,2,"0")+":"+G(l,2,"0")},m:function f(b,h){if(b.date()<h.date())return-f(h,b);var D=12*(h.year()-b.year())+(h.month()-b.month()),l=b.clone().add(D,m),w=h-l<0,r=b.clone().add(D+(w?-1:1),m);return+(-(D+(h-l)/(w?l-r:r-l))||0)},a:function(f){return f<0?Math.ceil(f)||0:Math.floor(f)},p:function(f){return{M:m,y:g,w:c,d:F,D:I,h:v,m:A,s:p,ms:a,Q:C}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(f){return f===void 0}},V="en",q={};q[V]=K;var X="$isDayjsObject",te=function(f){return f instanceof E||!(!f||!f[X])},ue=function f(b,h,D){var l;if(!b)return V;if(typeof b=="string"){var w=b.toLowerCase();q[w]&&(l=w),h&&(q[w]=h,l=w);var r=b.split("-");if(!l&&r.length>1)return f(r[0])}else{var x=b.name;q[x]=b,l=x}return!D&&l&&(V=l),l||!D&&V},S=function(f,b){if(te(f))return f.clone();var h=typeof b=="object"?b:{};return h.date=f,h.args=arguments,new E(h)},d=Y;d.l=ue,d.i=te,d.w=function(f,b){return S(f,{locale:b.$L,utc:b.$u,x:b.$x,$offset:b.$offset})};var E=function(){function f(h){this.$L=ue(h.locale,null,!0),this.parse(h),this.$x=this.$x||h.x||{},this[X]=!0}var b=f.prototype;return b.parse=function(h){this.$d=function(D){var l=D.date,w=D.utc;if(l===null)return new Date(NaN);if(d.u(l))return new Date;if(l instanceof Date)return new Date(l);if(typeof l=="string"&&!/Z$/i.test(l)){var r=l.match(z);if(r){var x=r[2]-1||0,j=(r[7]||"0").substring(0,3);return w?new Date(Date.UTC(r[1],x,r[3]||1,r[4]||0,r[5]||0,r[6]||0,j)):new Date(r[1],x,r[3]||1,r[4]||0,r[5]||0,r[6]||0,j)}}return new Date(l)}(h),this.init()},b.init=function(){var h=this.$d;this.$y=h.getFullYear(),this.$M=h.getMonth(),this.$D=h.getDate(),this.$W=h.getDay(),this.$H=h.getHours(),this.$m=h.getMinutes(),this.$s=h.getSeconds(),this.$ms=h.getMilliseconds()},b.$utils=function(){return d},b.isValid=function(){return this.$d.toString()!==P},b.isSame=function(h,D){var l=S(h);return this.startOf(D)<=l&&l<=this.endOf(D)},b.isAfter=function(h,D){return S(h)<this.startOf(D)},b.isBefore=function(h,D){return this.endOf(D)<S(h)},b.$g=function(h,D,l){return d.u(h)?this[D]:this.set(l,h)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(h,D){var l=this,w=!!d.u(D)||D,r=d.p(h),x=function(ae,oe){var Ae=d.w(l.$u?Date.UTC(l.$y,oe,ae):new Date(l.$y,oe,ae),l);return w?Ae:Ae.endOf(F)},j=function(ae,oe){return d.w(l.toDate()[ae].apply(l.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(oe)),l)},R=this.$W,J=this.$M,B=this.$D,W="set"+(this.$u?"UTC":"");switch(r){case g:return w?x(1,0):x(31,11);case m:return w?x(1,J):x(0,J+1);case c:var ee=this.$locale().weekStart||0,le=(R<ee?R+7:R)-ee;return x(w?B-le:B+(6-le),J);case F:case I:return j(W+"Hours",0);case v:return j(W+"Minutes",1);case A:return j(W+"Seconds",2);case p:return j(W+"Milliseconds",3);default:return this.clone()}},b.endOf=function(h){return this.startOf(h,!1)},b.$set=function(h,D){var l,w=d.p(h),r="set"+(this.$u?"UTC":""),x=(l={},l[F]=r+"Date",l[I]=r+"Date",l[m]=r+"Month",l[g]=r+"FullYear",l[v]=r+"Hours",l[A]=r+"Minutes",l[p]=r+"Seconds",l[a]=r+"Milliseconds",l)[w],j=w===F?this.$D+(D-this.$W):D;if(w===m||w===g){var R=this.clone().set(I,1);R.$d[x](j),R.init(),this.$d=R.set(I,Math.min(this.$D,R.daysInMonth())).$d}else x&&this.$d[x](j);return this.init(),this},b.set=function(h,D){return this.clone().$set(h,D)},b.get=function(h){return this[d.p(h)]()},b.add=function(h,D){var l,w=this;h=Number(h);var r=d.p(D),x=function(J){var B=S(w);return d.w(B.date(B.date()+Math.round(J*h)),w)};if(r===m)return this.set(m,this.$M+h);if(r===g)return this.set(g,this.$y+h);if(r===F)return x(1);if(r===c)return x(7);var j=(l={},l[A]=s,l[v]=i,l[p]=o,l)[r]||1,R=this.$d.getTime()+h*j;return d.w(R,this)},b.subtract=function(h,D){return this.add(-1*h,D)},b.format=function(h){var D=this,l=this.$locale();if(!this.isValid())return l.invalidDate||P;var w=h||"YYYY-MM-DDTHH:mm:ssZ",r=d.z(this),x=this.$H,j=this.$m,R=this.$M,J=l.weekdays,B=l.months,W=l.meridiem,ee=function(oe,Ae,_e,$e){return oe&&(oe[Ae]||oe(D,w))||_e[Ae].slice(0,$e)},le=function(oe){return d.s(x%12||12,oe,"0")},ae=W||function(oe,Ae,_e){var $e=oe<12?"AM":"PM";return _e?$e.toLowerCase():$e};return w.replace(k,function(oe,Ae){return Ae||function(_e){switch(_e){case"YY":return String(D.$y).slice(-2);case"YYYY":return d.s(D.$y,4,"0");case"M":return R+1;case"MM":return d.s(R+1,2,"0");case"MMM":return ee(l.monthsShort,R,B,3);case"MMMM":return ee(B,R);case"D":return D.$D;case"DD":return d.s(D.$D,2,"0");case"d":return String(D.$W);case"dd":return ee(l.weekdaysMin,D.$W,J,2);case"ddd":return ee(l.weekdaysShort,D.$W,J,3);case"dddd":return J[D.$W];case"H":return String(x);case"HH":return d.s(x,2,"0");case"h":return le(1);case"hh":return le(2);case"a":return ae(x,j,!0);case"A":return ae(x,j,!1);case"m":return String(j);case"mm":return d.s(j,2,"0");case"s":return String(D.$s);case"ss":return d.s(D.$s,2,"0");case"SSS":return d.s(D.$ms,3,"0");case"Z":return r}return null}(oe)||r.replace(":","")})},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(h,D,l){var w,r=this,x=d.p(D),j=S(h),R=(j.utcOffset()-this.utcOffset())*s,J=this-j,B=function(){return d.m(r,j)};switch(x){case g:w=B()/12;break;case m:w=B();break;case C:w=B()/3;break;case c:w=(J-R)/6048e5;break;case F:w=(J-R)/864e5;break;case v:w=J/i;break;case A:w=J/s;break;case p:w=J/o;break;default:w=J}return l?w:d.a(w)},b.daysInMonth=function(){return this.endOf(m).$D},b.$locale=function(){return q[this.$L]},b.locale=function(h,D){if(!h)return this.$L;var l=this.clone(),w=ue(h,D,!0);return w&&(l.$L=w),l},b.clone=function(){return d.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},f}(),$=E.prototype;return S.prototype=$,[["$ms",a],["$s",p],["$m",A],["$H",v],["$W",F],["$M",m],["$y",g],["$D",I]].forEach(function(f){$[f[1]]=function(b){return this.$g(b,f[0],f[1])}}),S.extend=function(f,b){return f.$i||(f(b,E,S),f.$i=!0),S},S.locale=ue,S.isDayjs=te,S.unix=function(f){return S(1e3*f)},S.en=q[V],S.Ls=q,S.p={},S})})(Et);var zn=Et.exports;const Ln=At(zn);function Nn(u){const[n,o]=t.useState(!1),[s,i]=t.useState(!1),[a,p]=t.useState({LogConsumeEnabled:!1,historyTimestamp:Ln().subtract(1,"month").toDate()}),A=t.useRef(),[v,F]=t.useState(a);function c(){const C=Qe(a,v).filter(I=>I.key!=="historyTimestamp");if(!C.length)return Ve("你似乎并没有修改什么");const g=C.map(I=>{let P="";return typeof a[I.key]=="boolean"?P=String(a[I.key]):P=a[I.key],M.put("/api/option/",{key:I.key,value:P})});o(!0),Promise.all(g).then(I=>{if(g.length===1){if(I.includes(void 0))return}else if(g.length>1&&I.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}async function m(){try{if(i(!0),!a.historyTimestamp)throw new Error("请选择日志记录时间");const C=await M.delete(`/api/log/?target_timestamp=${Date.parse(a.historyTimestamp)/1e3}`),{success:g,message:I,data:P}=C.data;if(g){Q(`${P} 条日志已清理！`);return}else throw new Error("日志清理失败："+I)}catch(C){y(C.message)}finally{i(!1)}}return t.useEffect(()=>{const C={};for(let g in u.options)Object.keys(a).includes(g)&&(C[g]=u.options[g]);C.historyTimestamp=a.historyTimestamp,p(Object.assign(a,C)),F(structuredClone(C)),A.current.setValues(C)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:a,getFormApi:C=>A.current=C,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"日志设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"LogConsumeEnabled",label:"启用额度消费日志记录",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:C=>{p({...a,LogConsumeEnabled:C})}})}),e.jsx(ce,{span:8,children:e.jsxs(De,{spinning:s,children:[e.jsx(N.DatePicker,{label:"日志记录时间",field:"historyTimestamp",type:"dateTime",inputReadOnly:!0,onChange:C=>{p({...a,historyTimestamp:C})}}),e.jsx(T,{size:"default",onClick:m,children:"清除历史日志"})]})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:c,children:"保存日志设置"})})]})})})})}function Wn(u){const n=[{key:"hour",label:"小时",value:"hour"},{key:"day",label:"天",value:"day"},{key:"week",label:"周",value:"week"}],[o,s]=t.useState(!1),[i,a]=t.useState({DataExportEnabled:!1,DataExportInterval:"",DataExportDefaultTime:""}),p=t.useRef(),[A,v]=t.useState(i);function F(){const c=Qe(i,A);if(!c.length)return Ve("你似乎并没有修改什么");const m=c.map(C=>{let g="";return typeof i[C.key]=="boolean"?g=String(i[C.key]):g=i[C.key],M.put("/api/option/",{key:C.key,value:g})});s(!0),Promise.all(m).then(C=>{if(m.length===1){if(C.includes(void 0))return}else if(m.length>1&&C.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{s(!1)})}return t.useEffect(()=>{const c={};for(let m in u.options)Object.keys(i).includes(m)&&(c[m]=u.options[m]);a(c),v(structuredClone(c)),p.current.setValues(c),localStorage.setItem("data_export_default_time",String(i.DataExportDefaultTime))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:o,children:e.jsx(N,{values:i,getFormApi:c=>p.current=c,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"数据看板设置",children:[e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"DataExportEnabled",label:"启用数据看板（实验性）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:c=>{a({...i,DataExportEnabled:c})}})})}),e.jsxs(ge,{children:[e.jsx(ce,{span:8,children:e.jsx(N.InputNumber,{label:"数据看板更新间隔 ",step:1,min:1,suffix:"分钟",extraText:"设置过短会影响数据库性能",placeholder:"数据看板更新间隔",field:"DataExportInterval",onChange:c=>a({...i,DataExportInterval:String(c)})})}),e.jsx(ce,{span:8,children:e.jsx(N.Select,{label:"数据看板默认时间粒度",optionList:n,field:"DataExportDefaultTime",extraText:"仅修改展示粒度，统计精确到小时",placeholder:"数据看板默认时间粒度",style:{width:180},onChange:c=>a({...i,DataExportDefaultTime:String(c)})})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:F,children:"保存数据看板设置"})})]})})})})}function Un(u){const[n,o]=t.useState(!1),[s,i]=t.useState({ChannelDisableThreshold:"",QuotaRemindThreshold:"",AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1}),a=t.useRef(),[p,A]=t.useState(s);function v(){const F=Qe(s,p);if(!F.length)return Ve("你似乎并没有修改什么");const c=F.map(m=>{let C="";return typeof s[m.key]=="boolean"?C=String(s[m.key]):C=s[m.key],M.put("/api/option/",{key:m.key,value:C})});o(!0),Promise.all(c).then(m=>{if(c.length===1){if(m.includes(void 0))return}else if(c.length>1&&m.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}return t.useEffect(()=>{const F={};for(let c in u.options)Object.keys(s).includes(c)&&(F[c]=u.options[c]);i(F),A(structuredClone(F)),a.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:s,getFormApi:F=>a.current=F,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"监控设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.InputNumber,{label:"最长响应时间",step:1,min:0,suffix:"秒",extraText:"当运行通道全部测试时，超过此时间将自动禁用通道",placeholder:"",field:"ChannelDisableThreshold",onChange:F=>i({...s,ChannelDisableThreshold:String(F)})})}),e.jsx(ce,{span:8,children:e.jsx(N.InputNumber,{label:"额度提醒阈值",step:1,min:0,suffix:"Token",extraText:"低于此额度时将发送邮件提醒用户",placeholder:"",field:"QuotaRemindThreshold",onChange:F=>i({...s,QuotaRemindThreshold:String(F)})})})]}),e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"AutomaticDisableChannelEnabled",label:"失败时自动禁用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{i({...s,AutomaticDisableChannelEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(N.Switch,{field:"AutomaticEnableChannelEnabled",label:"成功时自动启用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,AutomaticEnableChannelEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:v,children:"保存监控设置"})})]})})})})}function Kn(u){const[n,o]=t.useState(!1),[s,i]=t.useState({QuotaForNewUser:"",PreConsumedQuota:"",QuotaForInviter:"",QuotaForInvitee:""}),a=t.useRef(),[p,A]=t.useState(s);function v(){const F=Qe(s,p);if(!F.length)return Ve("你似乎并没有修改什么");const c=F.map(m=>{let C="";return typeof s[m.key]=="boolean"?C=String(s[m.key]):C=s[m.key],M.put("/api/option/",{key:m.key,value:C})});o(!0),Promise.all(c).then(m=>{if(c.length===1){if(m.includes(void 0))return}else if(c.length>1&&m.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}return t.useEffect(()=>{const F={};for(let c in u.options)Object.keys(s).includes(c)&&(F[c]=u.options[c]);i(F),A(structuredClone(F)),a.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(N,{values:s,getFormApi:F=>a.current=F,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"额度设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:6,children:e.jsx(N.InputNumber,{label:"新用户初始额度",field:"QuotaForNewUser",step:1,min:0,suffix:"Token",placeholder:"",onChange:F=>i({...s,QuotaForNewUser:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(N.InputNumber,{label:"请求预扣费额度",field:"PreConsumedQuota",step:1,min:0,suffix:"Token",extraText:"请求结束后多退少补",placeholder:"",onChange:F=>i({...s,PreConsumedQuota:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(N.InputNumber,{label:"邀请新用户奖励额度",field:"QuotaForInviter",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：2000",onChange:F=>i({...s,QuotaForInviter:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(N.InputNumber,{label:"新用户使用邀请码奖励额度",field:"QuotaForInvitee",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：1000",onChange:F=>i({...s,QuotaForInvitee:String(F)})})})]}),e.jsx(ge,{children:e.jsx(T,{size:"large",onClick:v,children:"保存额度设置"})})]})})})})}function Gn(u){const[n,o]=t.useState(!1),[s,i]=t.useState({ModelPrice:"",ModelRatio:"",CompletionRatio:"",GroupRatio:""}),a=t.useRef(),[p,A]=t.useState(s);async function v(){try{console.log("Starting validation..."),await a.current.validate().then(()=>{console.log("Validation passed");const c=Qe(s,p);if(!c.length)return Ve("你似乎并没有修改什么");const m=c.map(C=>{let g="";return typeof s[C.key]=="boolean"?g=String(s[C.key]):g=s[C.key],M.put("/api/option/",{key:C.key,value:g})});o(!0),Promise.all(m).then(C=>{if(m.length===1){if(C.includes(void 0))return}else if(m.length>1&&C.includes(void 0))return y("部分保存失败，请重试");Q("保存成功"),u.refresh()}).catch(()=>{y("保存失败，请重试")}).finally(()=>{o(!1)})}).catch(c=>{console.error("Validation failed:",c),y("请检查输入")})}catch(c){y("请检查输入"),console.error(c)}}async function F(){try{let c=await M.post("/api/option/rest_model_ratio");c.data.success?(Q(c.data.message),u.refresh()):y(c.data.message)}catch(c){y(c)}}return t.useEffect(()=>{const c={};for(let m in u.options)Object.keys(s).includes(m)&&(c[m]=u.options[m]);i(c),A(structuredClone(c)),a.current.setValues(c)},[u.options]),e.jsxs(De,{spinning:n,children:[e.jsx(N,{values:s,getFormApi:c=>a.current=c,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"倍率设置",children:[e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(N.TextArea,{label:"模型固定价格",extraText:"一次调用消耗多少刀，优先级大于模型倍率",placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀',field:"ModelPrice",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(c,m)=>au(m),message:"不是合法的 JSON 字符串"}],onChange:c=>i({...s,ModelPrice:c})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(N.TextArea,{label:"模型倍率",extraText:"",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"ModelRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(c,m)=>au(m),message:"不是合法的 JSON 字符串"}],onChange:c=>i({...s,ModelRatio:c})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(N.TextArea,{label:"模型补全倍率（仅对自定义模型有效）",extraText:"仅对自定义模型有效",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"CompletionRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(c,m)=>au(m),message:"不是合法的 JSON 字符串"}],onChange:c=>i({...s,CompletionRatio:c})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(N.TextArea,{label:"分组倍率",extraText:"",placeholder:"为一个 JSON 文本，键为分组名称，值为倍率",field:"GroupRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(c,m)=>au(m),message:"不是合法的 JSON 字符串"}],onChange:c=>i({...s,GroupRatio:c})})})})]})}),e.jsxs(de,{children:[e.jsx(T,{onClick:v,children:"保存倍率设置"}),e.jsx(we,{title:"确定重置模型倍率吗？",content:"此修改将不可逆",okType:"danger",position:"top",onConfirm:()=>{F()},children:e.jsx(T,{type:"danger",children:"重置模型倍率"})})]})]})}const Hn=()=>{let[u,n]=t.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",CompletionRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1,ChannelDisableThreshold:0,LogConsumeEnabled:!1,DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjModeClearEnabled:!1,MjForwardUrlEnabled:!1,DrawingEnabled:!1,DataExportEnabled:!1,DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:!1,RetryTimes:0}),[o,s]=t.useState(!1);const i=async()=>{const p=await M.get("/api/option/"),{success:A,message:v,data:F}=p.data;if(A){let c={};F.forEach(m=>{(m.key==="ModelRatio"||m.key==="GroupRatio"||m.key==="CompletionRatio"||m.key==="ModelPrice")&&(m.value=JSON.stringify(JSON.parse(m.value),null,2)),m.key.endsWith("Enabled")||["DefaultCollapseSidebar"].includes(m.key)?c[m.key]=m.value==="true":c[m.key]=m.value}),n(c)}else y(v)};async function a(){try{s(!0),await i(),Q("刷新成功")}catch{y("刷新失败")}finally{s(!1)}}return t.useEffect(()=>{a()},[]),e.jsx(e.Fragment,{children:e.jsxs(De,{spinning:o,size:"large",children:[e.jsx(be,{style:{marginTop:"10px"},children:e.jsx($n,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Rn,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(On,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Nn,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Wn,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Un,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Kn,{options:u,refresh:a})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Gn,{options:u,refresh:a})})]})})},qn=()=>{const u=Me(),n=bt(),[o,s]=t.useState("1");let i=[{tab:"个人设置",content:e.jsx(Mn,{}),itemKey:"personal"}];ct()&&(i.push({tab:"运营设置",content:e.jsx(Hn,{}),itemKey:"operation"}),i.push({tab:"系统设置",content:e.jsx(In,{}),itemKey:"system"}),i.push({tab:"其他设置",content:e.jsx(Pn,{}),itemKey:"other"}));const a=p=>{s(p),u(`?tab=${p}`)};return t.useEffect(()=>{const A=new URLSearchParams(window.location.search).get("tab");A?s(A):a("personal")},[n.search]),e.jsx("div",{children:e.jsx(ie,{children:e.jsx(ie.Content,{children:e.jsx(Tt,{type:"line",activeKey:o,onChange:p=>a(p),children:i.map(p=>e.jsx(It,{itemKey:p.itemKey,tab:p.tab,children:o===p.itemKey&&p.content},p.itemKey))})})})})},Vn=()=>{const[u,n]=t.useState({email:""}),{email:o}=u,[s,i]=t.useState(!1),[a,p]=t.useState(!1),[A,v]=t.useState(""),[F,c]=t.useState(""),[m,C]=t.useState(!1),[g,I]=t.useState(30);t.useEffect(()=>{let k=null;return m&&g>0?k=setInterval(()=>{I(g-1)},1e3):g===0&&(C(!1),I(30)),()=>clearInterval(k)},[m,g]);function P(k){const{name:K,value:G}=k.target;n(Y=>({...Y,[K]:G}))}async function z(k){if(C(!0),!o)return;if(a&&F===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}i(!0);const K=await M.get(`/api/reset_password?email=${o}&turnstile=${F}`),{success:G,message:Y}=K.data;G?(Q("重置邮件发送成功，请检查邮箱！"),n({...u,email:""})):y(Y),i(!1)}return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(je,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:"/logo.png"})," 密码重置"]}),e.jsx(U,{size:"large",children:e.jsxs(Au,{children:[e.jsx(U.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:o,onChange:P}),a?e.jsx(ru,{sitekey:A,onVerify:k=>{c(k)}}):e.jsx(e.Fragment,{}),e.jsx(Xe,{color:"green",fluid:!0,size:"large",onClick:z,loading:s,disabled:m,children:m?`重试 (${g})`:"提交"})]})})]})})},Qn=()=>{const[u,n]=Ou(),[o,s]=t.useContext(Je),[i,a]=t.useState("处理中...");t.useState(!0);let p=Me();const A=async(v,F,c)=>{const m=await M.get(`/api/oauth/github?code=${v}&state=${F}`),{success:C,message:g,data:I}=m.data;if(C)g==="bind"?(Q("绑定成功！"),p("/setting")):(s({type:"login",payload:I}),localStorage.setItem("user",JSON.stringify(I)),Q("登录成功！"),p("/"));else{y(g);{a("操作失败，重定向至登录界面中..."),p("/setting");return}}};return t.useEffect(()=>{let v=u.get("code"),F=u.get("state");A(v,F).then()},[]),e.jsx(Au,{style:{minHeight:"300px"},children:e.jsx(Yt,{active:!0,inverted:!0,children:e.jsx(Zt,{size:"large",children:i})})})},Jn=()=>{const[u,n]=t.useState({email:"",token:""}),{email:o,token:s}=u,[i,a]=t.useState(!1),[p,A]=t.useState(!1),[v,F]=t.useState(30),[c,m]=t.useState(""),[C,g]=Ou();t.useEffect(()=>{let P=C.get("token"),z=C.get("email");n({token:P,email:z})},[]),t.useEffect(()=>{let P=null;return p&&v>0?P=setInterval(()=>{F(v-1)},1e3):v===0&&(A(!1),F(30)),()=>clearInterval(P)},[p,v]);async function I(P){if(A(!0),!o)return;a(!0);const z=await M.post("/api/user/reset",{email:o,token:s}),{success:k,message:K}=z.data;if(k){let G=z.data.data;m(G),await ze(G),Gu(`新密码已复制到剪贴板：${G}`)}else y(K);a(!1)}return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(je,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(U,{size:"large",children:e.jsxs(Au,{children:[e.jsx(U.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:o,readOnly:!0}),c&&e.jsx(U.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:c,readOnly:!0,onClick:P=>{P.target.select(),navigator.clipboard.writeText(c),Gu(`密码已复制到剪贴板：${c}`)}}),e.jsx(Xe,{color:"green",fluid:!0,size:"large",onClick:I,loading:i,disabled:p,children:p?"密码重置完成":"提交"})]})})]})})},Vu={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"},Qu={400:"500"},Yn="1. 新建渠道时，请求通过当前浏览器发出；2. 编辑已有渠道，请求通过后端服务器发出";function Zn(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";case 33:return"按照如下格式输入：Ak|Sk|Region";default:return"请输入渠道对应的鉴权密钥"}}const Ru=u=>{Me();const n=u.editingChannel.id,o=n!==void 0,[s,i]=t.useState(o),a=()=>{u.handleClose()},p={name:"",type:1,key:"",openai_organization:"",max_input_tokens:0,base_url:"",other:"",model_mapping:"",status_code_mapping:"",models:[],auto_ban:1,is_image:!1,test_model:"",groups:["default"]},[A,v]=t.useState(!1),[F,c]=t.useState(!1),[m,C]=t.useState(!0),[g,I]=t.useState(p),[P,z]=t.useState([]),[k,K]=t.useState([]),[G,Y]=t.useState([]),[V,q]=t.useState([]),[X,te]=t.useState([]),[ue,S]=t.useState(""),d=(l,w)=>{if(I(r=>({...r,[l]:w})),l==="type"){let r=[];switch(w){case 2:r=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_uploads"];break;case 5:r=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan","mj_uploads"];break;default:r=_u(w);break}g.models.length===0&&I(x=>({...x,models:r})),q(r)}},E=async()=>{i(!0);let l=await M.get(`/api/channel/${n}`);if(l===void 0)return;const{success:w,message:r,data:x}=l.data;w?(x.models===""?x.models=[]:x.models=x.models.split(","),x.group===""?x.groups=[]:x.groups=x.group.split(","),x.model_mapping!==""&&(x.model_mapping=JSON.stringify(JSON.parse(x.model_mapping),null,2)),I(x),x.auto_ban===0?C(!1):C(!0),x.is_image==!1?c(!1):c(!0),q(_u(x.type))):y(r),i(!1)},$=async l=>{var x,j;if(g.type!==1){y("仅支持 OpenAI 接口格式");return}i(!0);const w=g.models||[];let r=!1;if(o){const R=await M.get("/api/channel/fetch_models/"+n);R.data&&((x=R.data)!=null&&x.success)?w.push(...R.data.data):r=!0}else if(!(g!=null&&g.key))y("请填写密钥"),r=!0;else try{const J=`https://${new URL(g.base_url||"https://api.openai.com").hostname}/v1/models`,B=g.key,W=await rt.get(J,{headers:{Authorization:`Bearer ${B}`}});W.data&&((j=W.data)!=null&&j.success)?w.push(...es.data.data.map(ee=>ee.id)):r=!0}catch{r=!0}r?y("获取模型列表失败"):(d(l,Array.from(new Set(w))),Q("获取模型列表成功")),i(!1)},f=async()=>{try{let l=await M.get("/api/channel/models"),w=l.data.data.map(r=>({label:r.id,value:r.id}));z(w),te(l.data.data.map(r=>r.id)),q(l.data.data.filter(r=>r.id.startsWith("gpt-3")||r.id.startsWith("text-")).map(r=>r.id))}catch(l){y(l.message)}},b=async()=>{try{let l=await M.get("/api/group/");if(l===void 0)return;Y(l.data.data.map(w=>({label:w,value:w})))}catch(l){y(l.message)}};t.useEffect(()=>{let l=[...P];g.models.forEach(w=>{l.find(r=>r.key===w)||l.push({label:w,value:w})}),K(l)},[P,g.models]),t.useEffect(()=>{if(f().then(),b().then(),o)E().then(()=>{});else{I(p);let l=_u(g.type);q(l),I(w=>({...w,models:l}))}},[u.editingChannel.id]);const h=async()=>{if(!o&&(g.name===""||g.key==="")){Be("请填写渠道名称和渠道密钥！");return}if(g.models.length===0){Be("请至少选择一个模型！");return}if(g.model_mapping!==""&&!au(g.model_mapping)){Be("模型映射必须是合法的 JSON 格式！");return}let l={...g};l.base_url&&l.base_url.endsWith("/")&&(l.base_url=l.base_url.slice(0,l.base_url.length-1)),l.type===3&&l.other===""&&(l.other="2023-06-01-preview"),l.type===18&&l.other===""&&(l.other="v2.1");let w;if(!Array.isArray(l.models)){y("提交失败，请勿重复提交！"),a();return}l.auto_ban=m?1:0,l.is_image=!!F,l.models=l.models.join(","),l.group=l.groups.join(","),o?w=await M.put("/api/channel/",{...l,id:parseInt(n)}):w=await M.post("/api/channel/",l);const{success:r,message:x}=w.data;r?(o?Q("渠道更新成功！"):(Q("渠道创建成功！"),I(p)),u.refresh(),u.handleClose()):y(x)},D=()=>{if(ue.trim()==="")return;const l=ue.split(",").map(j=>j.trim());let w=[...g.models],r=[...k],x=!1;l.forEach(j=>{j&&!w.includes(j)?(w.push(j),r.push({key:j,text:j,value:j})):j&&(y("某些模型已存在！"),x=!0)}),!x&&(K(r),S(""),d("models",w))};return e.jsx(e.Fragment,{children:e.jsx(hu,{maskClosable:!1,placement:o?"right":"left",title:e.jsx(eu,{level:3,children:o?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:h,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:a,children:"取消"})]})}),closeIcon:null,onCancel:()=>a(),width:ve()?"100%":600,children:e.jsxs(De,{spinning:s,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"类型："})}),e.jsx(Ie,{name:"type",required:!0,optionList:ju,value:g.type,onChange:l=>d("type",l),style:{width:"50%"}}),g.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ue,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(se,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:l=>{d("base_url",l)},value:g.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(se,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:l=>{d("other",l)},value:g.other,autoComplete:"new-password"})]}),g.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ue,{type:"warning",description:e.jsx(e.Fragment,{children:"如果你对接的是上游One API或者New API等转发项目，请使用OpenAI类型，不要使用此类型，除非你知道你在做什么。"})})}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(Z.Text,{strong:!0,children:["完整的 Base URL，支持变量","{model}","："]})}),e.jsx(se,{name:"base_url",placeholder:"请输入完整的URL，例如：https://api.openai.com/v1/chat/completions",onChange:l=>{d("base_url",l)},value:g.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"名称："})}),e.jsx(se,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:l=>{d("name",l)},value:g.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"分组："})}),e.jsx(Ie,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:l=>{d("groups",l)},value:g.groups,autoComplete:"new-password",optionList:G}),g.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"模型版本："})}),e.jsx(se,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:l=>{d("other",l)},value:g.other,autoComplete:"new-password"})]}),g.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(se,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:l=>{d("other",l)},value:g.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"模型："})}),e.jsx(Ie,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:l=>{d("models",l)},value:g.models,autoComplete:"new-password",optionList:k}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(de,{children:[e.jsx(T,{type:"primary",onClick:()=>{d("models",V)},children:"填入相关模型"}),e.jsx(T,{type:"secondary",onClick:()=>{d("models",X)},children:"填入所有模型"}),e.jsx(Pe,{content:Yn,children:e.jsx(T,{type:"tertiary",onClick:()=>{$("models")},children:"获取模型列表"})}),e.jsx(T,{type:"warning",onClick:()=>{d("models",[])},children:"清除所有模型"})]}),e.jsx(se,{addonAfter:e.jsx(T,{type:"primary",onClick:D,children:"填入"}),placeholder:"输入自定义模型名称",value:ue,onChange:l=>{S(l.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"模型重定向："})}),e.jsx(vu,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify(Vu,null,2)}`,name:"model_mapping",onChange:l=>{d("model_mapping",l)},autosize:!0,value:g.model_mapping,autoComplete:"new-password"}),e.jsx(Z.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{d("model_mapping",JSON.stringify(Vu,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"密钥："})}),A?e.jsx(vu,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:l=>{d("key",l)},value:g.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(se,{label:"密钥",name:"key",required:!0,placeholder:Zn(g.type),onChange:l=>{d("key",l)},value:g.key,autoComplete:"new-password"}),g.type===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"组织："})}),e.jsx(se,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:l=>{d("openai_organization",l)},value:g.openai_organization})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"默认测试模型："})}),e.jsx(se,{name:"test_model",placeholder:"不填则为模型列表第一个",onChange:l=>{d("test_model",l)},value:g.test_model}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(fu,{name:"auto_ban",checked:m,onChange:()=>{C(!m)}}),e.jsx(Z.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!o&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(fu,{checked:A,label:"批量创建",name:"batch",onChange:()=>v(!A)}),e.jsx(Z.Text,{strong:!0,children:"批量创建"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(fu,{checked:F,label:"is_image",name:"is_image",onChange:()=>c(!F)}),e.jsx(Z.Text,{strong:!0,children:"is_image"})]})}),g.type!==3&&g.type!==8&&g.type!==22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"代理："})}),e.jsx(se,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:l=>{d("base_url",l)},value:g.base_url,autoComplete:"new-password"})]}),g.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(se,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:l=>{d("base_url",l)},value:g.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Z.Text,{strong:!0,children:"状态码复写（仅影响本地判断，不修改返回到上游的状态码）："})}),e.jsx(vu,{placeholder:`此项可选，用于复写返回的状态码，比如将claude渠道的400错误复写为500（用于重试），请勿滥用该功能，例如：
${JSON.stringify(Qu,null,2)}`,name:"status_code_mapping",onChange:l=>{d("status_code_mapping",l)},autosize:!0,value:g.status_code_mapping,autoComplete:"new-password"}),e.jsx(Z.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{d("status_code_mapping",JSON.stringify(Qu,null,2))},children:"填入模板"})]})})})};let nu;function Xn(u){var n,o;if(!nu){nu=new Map;for(let s=0;s<ju.length;s++)nu[ju[s].value]=ju[s];nu[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx(L,{size:"large",color:(n=nu[u])==null?void 0:n.color,children:(o=nu[u])==null?void 0:o.text})}const us=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(_,O,ne)=>e.jsx("div",{children:e.jsx(de,{spacing:2,children:_.split(",").map((re,Fe)=>ht(re))})})},{title:"类型",dataIndex:"type",render:(_,O,ne)=>e.jsx("div",{children:Xn(_)})},{title:"状态",dataIndex:"status",render:(_,O,ne)=>e.jsx("div",{children:R(_)})},{title:"响应时间",dataIndex:"response_time",render:(_,O,ne)=>e.jsx("div",{children:J(_)})},{title:"已用/剩余",dataIndex:"expired_time",render:(_,O,ne)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Pe,{content:"已用额度",children:e.jsx(L,{color:"white",type:"ghost",size:"large",children:me(O.used_quota)})}),e.jsx(Pe,{content:"剩余额度"+O.balance+"，点击更新",children:e.jsxs(L,{color:"white",type:"ghost",size:"large",onClick:()=>{ae(O)},children:["$",Fn(O.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(_,O,ne)=>e.jsx("div",{children:e.jsx(Tu,{style:{width:70},name:"priority",onBlur:re=>{j(O.id,"priority",O,re.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(_,O,ne)=>e.jsx("div",{children:e.jsx(Tu,{style:{width:70},name:"weight",onBlur:re=>{j(O.id,"weight",O,re.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.weight,min:0})})},{title:"",dataIndex:"operate",render:(_,O,ne)=>e.jsxs("div",{children:[e.jsxs(et,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(T,{theme:"light",onClick:()=>{W(O,"")},children:"测试"}),e.jsx(He,{trigger:"click",position:"bottomRight",menu:O.test_models,children:e.jsx(T,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(ut,{})})})]}),e.jsx(we,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{j(O.id,"delete",O).then(()=>{D(O.id)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),O.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{j(O.id,"disable",O)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{j(O.id,"enable",O)},children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{f(O),S(!0)},children:"编辑"}),e.jsx(we,{title:"确定是否要复制此渠道？",content:"复制渠道的所有信息",okType:"danger",position:"left",onConfirm:async()=>{r(O.id)},children:e.jsx(T,{theme:"light",type:"primary",style:{marginRight:1},children:"复制"})})]})}],[n,o]=t.useState([]),[s,i]=t.useState(!0),[a,p]=t.useState(1),[A,v]=t.useState(!1),[F,c]=t.useState(""),[m,C]=t.useState(""),[g,I]=t.useState(""),[P,z]=t.useState(!1),[k,K]=t.useState(!1),[G,Y]=t.useState(he);t.useState(hn("channel-test"));const[V,q]=t.useState(G),[X,te]=t.useState([]),[ue,S]=t.useState(!1),[d,E]=t.useState(!1),[$,f]=t.useState({id:void 0}),[b,h]=t.useState([]),D=_=>{let O=[...n];if(_!=null){let ne=O.findIndex(re=>re.id===_);ne>-1&&(O.splice(ne,1),o(O))}},l=_=>{for(let O=0;O<_.length;O++){_[O].key=""+_[O].id;let ne=[];_[O].models.split(",").forEach((re,Fe)=>{ne.push({node:"item",name:re,onClick:()=>{W(_[O],re)}})}),_[O].test_models=ne}o(_),_.length>=G?q(_.length+G):q(_.length)},w=async(_,O,ne)=>{i(!0);const re=await M.get(`/api/channel/?p=${_}&page_size=${O}&id_sort=${ne}`);if(re===void 0)return;const{success:Fe,message:Ce,data:Oe}=re.data;if(Fe)if(_===0)l(Oe);else{let Ye=[...n];Ye.splice(_*O,Oe.length,...Oe),l(Ye)}else y(Ce);i(!1)},r=async _=>{const O=n.find(ne=>String(ne.id)===String(_));if(console.log(O),O.name+="_复制",O.created_time=null,O.balance=0,O.used_quota=0,!O){y("渠道未找到，请刷新页面后重试。");return}try{const ne={...O,id:void 0},re=await M.post("/api/channel/",ne);re.data.success?(Q("渠道复制成功"),await x()):y(re.data.message)}catch(ne){y("渠道复制失败: "+ne.message)}},x=async()=>{await w(a-1,G,A)};t.useEffect(()=>{const _=localStorage.getItem("id-sort")==="true",O=parseInt(localStorage.getItem("page-size"))||he;v(_),Y(O),w(0,O,_).then().catch(ne=>{y(ne)}),wu().then(),An().then()},[]);const j=async(_,O,ne,re)=>{let Fe={id:_},Ce;switch(O){case"delete":Ce=await M.delete(`/api/channel/${_}/`);break;case"enable":Fe.status=1,Ce=await M.put("/api/channel/",Fe);break;case"disable":Fe.status=2,Ce=await M.put("/api/channel/",Fe);break;case"priority":if(re==="")return;Fe.priority=parseInt(re),Ce=await M.put("/api/channel/",Fe);break;case"weight":if(re==="")return;Fe.weight=parseInt(re),Fe.weight<0&&(Fe.weight=0),Ce=await M.put("/api/channel/",Fe);break}const{success:Oe,message:Ye}=Ce.data;if(Oe){Q("操作成功完成！");let gu=Ce.data.data,H=[...n];O==="delete"||(ne.status=gu.status),o(H)}else y(Ye)},R=_=>{switch(_){case 1:return e.jsx(L,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx(L,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx(L,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx(L,{size:"large",color:"grey",children:"未知状态"})}},J=_=>{let O=_/1e3;return O=O.toFixed(2)+" 秒",_===0?e.jsx(L,{size:"large",color:"grey",children:"未测试"}):_<=1e3?e.jsx(L,{size:"large",color:"green",children:O}):_<=3e3?e.jsx(L,{size:"large",color:"lime",children:O}):_<=5e3?e.jsx(L,{size:"large",color:"yellow",children:O}):e.jsx(L,{size:"large",color:"red",children:O})},B=async(_,O,ne)=>{if(_===""&&O===""&&ne===""){await w(0,G,A),p(1);return}z(!0);const re=await M.get(`/api/channel/search?keyword=${_}&group=${O}&model=${ne}`),{success:Fe,message:Ce,data:Oe}=re.data;Fe?(o(Oe),p(1)):y(Ce),z(!1)},W=async(_,O)=>{const ne=await M.get(`/api/channel/test/${_.id}?model=${O}`),{success:re,message:Fe,time:Ce}=ne.data;re?(_.response_time=Ce*1e3,_.test_time=Date.now()/1e3,Be(`通道 ${_.name} 测试成功，耗时 ${Ce.toFixed(2)} 秒。`)):y(Fe)},ee=async()=>{const _=await M.get("/api/channel/test"),{success:O,message:ne}=_.data;O?Be("已成功开始测试所有通道，请刷新页面查看结果。"):y(ne)},le=async()=>{const _=await M.delete("/api/channel/disabled"),{success:O,message:ne,data:re}=_.data;O?(Q(`已删除所有禁用渠道，共计 ${re} 个`),await x()):y(ne)},ae=async _=>{const O=await M.get(`/api/channel/update_balance/${_.id}/`),{success:ne,message:re,balance:Fe}=O.data;ne?(_.balance=Fe,_.balance_updated_time=Date.now()/1e3,Be(`通道 ${_.name} 余额更新成功！`)):y(re)},oe=async()=>{K(!0);const _=await M.get("/api/channel/update_balance"),{success:O,message:ne}=_.data;O?Be("已更新完毕所有已启用通道余额！"):y(ne),K(!1)},Ae=async()=>{if(b.length===0){y("请先选择要删除的通道！");return}i(!0);let _=[];b.forEach(Ce=>{_.push(Ce.id)});const O=await M.post("/api/channel/batch",{ids:_}),{success:ne,message:re,data:Fe}=O.data;ne?(Q(`已删除 ${Fe} 个通道！`),await x()):y(re),i(!1)},_e=async()=>{const _=await M.post("/api/channel/fix"),{success:O,message:ne,data:re}=_.data;O?(Q(`已修复 ${re} 个通道！`),await x()):y(ne)};let $e=n.slice((a-1)*G,a*G);const Re=_=>{p(_),_===Math.ceil(n.length/G)+1&&w(_-1,G,A).then(O=>{})},tu=async _=>{localStorage.setItem("page-size",_+""),Y(_),p(1),w(0,_,A).then().catch(O=>{y(O)})},wu=async()=>{try{let _=await M.get("/api/group/");if(_===void 0)return;te(_.data.data.map(O=>({label:O,value:O})))}catch(_){y(_.message)}},pu=()=>{S(!1)},mu=(_,O)=>_.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Ru,{refresh:x,visible:ue,handleClose:pu,editingChannel:$}),e.jsx(N,{onSubmit:()=>{B(F,m,g)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(N.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:F,loading:P,onChange:_=>{c(_.trim())}}),e.jsx(N.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:g,loading:P,onChange:_=>{I(_.trim())}}),e.jsx(N.Select,{field:"group",label:"分组",optionList:X,onChange:_=>{C(_),B(F,_,g)}}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(de,{children:e.jsxs(de,{children:[e.jsx(Z.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Iu,{checked:A,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:_=>{localStorage.setItem("id-sort",_+""),v(_),w(0,G,_).then().catch(O=>{y(O)})}})]})})}),e.jsx(uu,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:$e,pagination:{currentPage:a,pageSize:G,total:V,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:_=>"",onPageSizeChange:_=>{tu(_).then()},onPageChange:Re},loading:s,onRow:mu,rowSelection:d?{onChange:(_,O)=>{h(O)}}:null}),e.jsx("div",{style:{display:ve()?"":"flex",marginTop:ve()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(de,{style:{pointerEvents:"auto",marginTop:ve()?0:45},children:[e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{f({id:void 0}),S(!0)},children:"添加渠道"}),e.jsx(we,{title:"确定？",okType:"warning",onConfirm:ee,position:(ve(),"top"),children:e.jsx(T,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(we,{title:"确定？",okType:"secondary",onConfirm:oe,children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(we,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:le,children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:x,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(Z.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Iu,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:_=>{E(_)}}),e.jsx(we,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:Ae,disabled:!d,position:"top",children:e.jsx(T,{disabled:!d,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(we,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:_e,position:"top",children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},ts=()=>e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(ie.Content,{children:e.jsx(us,{})})]})}),ns=u=>{const[n,o]=t.useState(!1),[s,i]=t.useState(n),a={name:"",remain_quota:n?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[p,A]=t.useState(a),{name:v,remain_quota:F,expired_time:c,unlimited_quota:m,model_limits_enabled:C,model_limits:g}=p,[I,P]=t.useState({});Me();const z=(d,E)=>{A($=>({...$,[d]:E}))},k=()=>{u.handleClose()},K=(d,E,$,f)=>{let h=new Date().getTime()/1e3,D=d*30*24*60*60;D+=E*24*60*60,D+=$*60*60,D+=f*60,D!==0?(h+=D,A({...p,expired_time:Le(h)})):A({...p,expired_time:-1})},G=()=>{A({...p,unlimited_quota:!m})},Y=async()=>{let d=await M.get("/api/user/models");const{success:E,message:$,data:f}=d.data;if(E){let b=f.map(h=>({label:h,value:h}));P(b)}else y($)},V=async()=>{i(!0);let d=await M.get(`/api/token/${u.editingToken.id}`);const{success:E,message:$,data:f}=d.data;E?(f.expired_time!==-1&&(f.expired_time=Le(f.expired_time)),f.model_limits!==""?f.model_limits=f.model_limits.split(","):f.model_limits=[],A(f)):y($),i(!1)};t.useEffect(()=>{o(u.editingToken.id!==void 0)},[u.editingToken.id]),t.useEffect(()=>{n?V().then(()=>{}):A(a),Y()},[n]);const[q,X]=t.useState(1),te=d=>{const E=parseInt(d,10);!isNaN(E)&&E>0&&X(E)},ue=()=>{const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let E="";for(let $=0;$<6;$++)E+=d.charAt(Math.floor(Math.random()*d.length));return E},S=async()=>{if(i(!0),n){let d={...p};if(d.remain_quota=parseInt(d.remain_quota),d.expired_time!==-1){let b=Date.parse(d.expired_time);if(isNaN(b)){y("过期时间格式错误！"),i(!1);return}d.expired_time=Math.ceil(b/1e3)}d.model_limits=d.model_limits.join(",");let E=await M.put("/api/token/",{...d,id:parseInt(u.editingToken.id)});const{success:$,message:f}=E.data;$?(Q("令牌更新成功！"),u.refresh(),u.handleClose()):y(f)}else{let d=0;for(let E=0;E<q;E++){let $={...p};if(E!==0&&($.name=`${p.name}-${ue()}`),$.remain_quota=parseInt($.remain_quota),$.expired_time!==-1){let D=Date.parse($.expired_time);if(isNaN(D)){y("过期时间格式错误！"),i(!1);break}$.expired_time=Math.ceil(D/1e3)}$.model_limits=$.model_limits.join(",");let f=await M.post("/api/token/",$);const{success:b,message:h}=f.data;if(b)d++;else{y(h);break}}d>0&&(Q(`${d}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}i(!1),A(a),X(1)};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:n?"right":"left",title:e.jsx(eu,{level:3,children:n?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:S,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:k,children:"取消"})]})}),closeIcon:null,onCancel:()=>k(),width:ve()?"100%":600,children:e.jsxs(De,{spinning:s,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:d=>z("name",d),value:v,autoComplete:"new-password",required:!n}),e.jsx(Se,{}),e.jsx(Pt,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:d=>z("expired_time",d),value:c,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(T,{type:"tertiary",onClick:()=>{K(0,0,0,0)},children:"永不过期"}),e.jsx(T,{type:"tertiary",onClick:()=>{K(0,0,1,0)},children:"一小时"}),e.jsx(T,{type:"tertiary",onClick:()=>{K(1,0,0,0)},children:"一个月"}),e.jsx(T,{type:"tertiary",onClick:()=>{K(0,1,0,0)},children:"一天"})]})}),e.jsx(Se,{}),e.jsx(Ue,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:`额度${ou(F)}`})}),e.jsx(Pu,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:d=>z("remain_quota",d),value:F,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:m}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:"新建数量"})}),e.jsx(Pu,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:d=>te(d),onSelect:d=>te(d),value:q.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:m})]}),e.jsx("div",{children:e.jsx(T,{style:{marginTop:8},type:"warning",onClick:()=>{G()},children:m?"取消无限额度":"设为无限额度"})}),e.jsx(Se,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(fu,{name:"model_limits_enabled",checked:C,onChange:d=>z("model_limits_enabled",d.target.checked)}),e.jsx(Z.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(Ie,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:d=>{z("model_limits",d)},value:p.model_limits,autoComplete:"new-password",optionList:I,disabled:!C})]})})})};function Ju(u){return e.jsx(e.Fragment,{children:Le(u)})}function ss(u,n=!1){switch(u){case 1:return n?e.jsx(L,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx(L,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs(L,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(L,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs(L,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs(L,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const as=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(j,R,J)=>e.jsx("div",{children:ss(j,R.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(j,R,J)=>e.jsx("div",{children:me(parseInt(j))})},{title:"剩余额度",dataIndex:"remain_quota",render:(j,R,J)=>e.jsx("div",{children:R.unlimited_quota?e.jsx(L,{size:"large",color:"white",children:"无限制"}):e.jsx(L,{size:"large",color:"light-blue",children:me(parseInt(j))})})},{title:"创建时间",dataIndex:"created_time",render:(j,R,J)=>e.jsx("div",{children:Ju(j)})},{title:"过期时间",dataIndex:"expired_time",render:(j,R,J)=>e.jsx("div",{children:R.expired_time===-1?"永不过期":Ju(j)})},{title:"",dataIndex:"operate",render:(j,R,J)=>e.jsxs("div",{children:[e.jsx(lu,{content:"sk-"+R.key,style:{padding:20},position:"top",children:e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async B=>{await E("sk-"+R.key)},children:"复制"}),e.jsxs(et,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(T,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{$("next",R.key)},children:"聊天"}),e.jsx(He,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{$("next",R.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{$("next-mj",R.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{$("ama",R.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{$("opencat",R.key)}}],children:e.jsx(T,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(ut,{})})})]}),e.jsx(we,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{b(R.id,"delete",R).then(()=>{f(R.key)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),R.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{b(R.id,"disable",R)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{b(R.id,"enable",R)},children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{q(R),i(!0)},children:"编辑"})]})}],[n,o]=t.useState(he),[s,i]=t.useState(!1),[a,p]=t.useState([]),[A,v]=t.useState([]),[F,c]=t.useState(n),[m,C]=t.useState(!0),[g,I]=t.useState(1),[P,z]=t.useState(""),[k,K]=t.useState(""),[G,Y]=t.useState(!1);t.useState(!1),t.useState(0);const[V,q]=t.useState({id:void 0}),X=()=>{i(!1),setTimeout(()=>{q({id:void 0})},500)},te=j=>{p(j),j.length>=n?c(j.length+n):c(j.length)};let ue=a.slice((g-1)*n,g*n);const S=async j=>{C(!0);const R=await M.get(`/api/token/?p=${j}&size=${n}`),{success:J,message:B,data:W}=R.data;if(J)if(j===0)te(W);else{let ee=[...a];ee.splice(j*n,W.length,...W),te(ee)}else y(B);C(!1)},d=async()=>{await S(g-1)},E=async j=>{await ze(j)?Q("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:j,size:"large"})},$=async(j,R)=>{let J=localStorage.getItem("status"),B="";J&&(J=JSON.parse(J),B=J.server_address),B===""&&(B=window.location.origin);let W=encodeURIComponent(B);const ee=localStorage.getItem("chat_link"),le=localStorage.getItem("chat_link2");let ae;ee&&(ae=ee+`/#/?settings={"key":"sk-${R}","url":"${B}"}`);let oe;switch(j){case"ama":oe=`ama://set-api-key?server=${W}&key=sk-${R}`;break;case"opencat":oe=`opencat://team/join?domain=${W}&token=sk-${R}`;break;case"next-mj":oe=le+`/#/?settings={"key":"sk-${R}","url":"${B}"}`;break;default:if(!ee){y("管理员未设置聊天链接");return}oe=ae}window.open(oe,"_blank")};t.useEffect(()=>{S(0).then().catch(j=>{y(j)})},[n]);const f=j=>{let R=[...a];if(j!=null){let J=R.findIndex(B=>B.key===j);J>-1&&(R.splice(J,1),te(R))}},b=async(j,R,J)=>{C(!0);let B={id:j},W;switch(R){case"delete":W=await M.delete(`/api/token/${j}/`);break;case"enable":B.status=1,W=await M.put("/api/token/?status_only=true",B);break;case"disable":B.status=2,W=await M.put("/api/token/?status_only=true",B);break}const{success:ee,message:le}=W.data;if(ee){Q("操作成功完成！");let ae=W.data.data,oe=[...a];R==="delete"||(J.status=ae.status),te(oe)}else y(le);C(!1)},h=async()=>{if(P===""&&k===""){await S(0),I(1);return}Y(!0);const j=await M.get(`/api/token/search?keyword=${P}&token=${k}`),{success:R,message:J,data:B}=j.data;R?(te(B),I(1)):y(J),Y(!1)},D=async j=>{z(j.trim())},l=async j=>{K(j.trim())},w=j=>{I(j),j===Math.ceil(a.length/n)+1&&S(j-1).then(R=>{})},r={onSelect:(j,R)=>{},onSelectAll:(j,R)=>{},onChange:(j,R)=>{v(R)}},x=(j,R)=>j.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(ns,{refresh:d,editingToken:V,visiable:s,handleClose:X}),e.jsxs(N,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(N.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:P,loading:G,onChange:D}),e.jsx(N.Input,{field:"token",label:"Key",placeholder:"密钥",value:k,loading:G,onChange:l}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:h,style:{marginRight:8},children:"查询"})]}),e.jsx(uu,{style:{marginTop:20},columns:u,dataSource:ue,pagination:{currentPage:g,pageSize:n,total:F,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:j=>`第 ${j.currentStart} - ${j.currentEnd} 条，共 ${a.length} 条`,onPageSizeChange:j=>{o(j),I(1)},onPageChange:w},loading:m,rowSelection:r,onRow:x}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{q({id:void 0}),i(!0)},children:"添加令牌"}),e.jsx(T,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(A.length===0){y("请至少选择一个令牌！");return}let j="";for(let R=0;R<A.length;R++)j+=A[R].name+"    sk-"+A[R].key+`
`;await E(j)},children:"复制所选令牌到剪贴板"})]})},rs=()=>e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(ie.Content,{children:e.jsx(as,{})})]})}),is=u=>{const n=u.editingRedemption.id!==void 0,[o,s]=t.useState(n);St(),Me();const i={name:"",quota:1e5,count:1},[a,p]=t.useState(i),{name:A,quota:v,count:F}=a,c=()=>{u.handleClose()},m=(I,P)=>{p(z=>({...z,[I]:P}))},C=async()=>{s(!0);let I=await M.get(`/api/redemption/${u.editingRedemption.id}`);const{success:P,message:z,data:k}=I.data;P?p(k):y(z),s(!1)};t.useEffect(()=>{n?C().then(()=>{}):p(i)},[u.editingRedemption.id]);const g=async()=>{if(!n&&a.name==="")return;s(!0);let I=a;I.count=parseInt(I.count),I.quota=parseInt(I.quota);let P;n?P=await M.put("/api/redemption/",{...I,id:parseInt(u.editingRedemption.id)}):P=await M.post("/api/redemption/",{...I});const{success:z,message:k,data:K}=P.data;if(z?n?(Q("兑换码更新成功！"),u.refresh(),u.handleClose()):(Q("兑换码创建成功！"),p(i),u.refresh(),u.handleClose()):y(k),!n&&K){let G="";for(let Y=0;Y<K.length;Y++)G+=K[Y]+`
`;fe.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{dn(G,`${a.name}.txt`)}})}s(!1)};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:n?"right":"left",title:e.jsx(eu,{level:3,children:n?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:g,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:c,children:"取消"})]})}),closeIcon:null,onCancel:()=>c(),width:ve()?"100%":600,children:e.jsxs(De,{spinning:o,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:I=>m("name",I),value:A,autoComplete:"new-password",required:!n}),e.jsx(Se,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Z.Text,{children:`额度${ou(v)}`})}),e.jsx(Pu,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:I=>m("quota",I),value:v,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(Z.Text,{children:"生成数量"}),e.jsx(se,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:I=>m("count",I),value:F,autoComplete:"new-password",type:"number"})]})]})})})};function ls(u){return e.jsx(e.Fragment,{children:Le(u)})}function os(u){switch(u){case 1:return e.jsx(L,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs(L,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(L,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs(L,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const cs=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(h,D,l)=>e.jsx("div",{children:os(h)})},{title:"额度",dataIndex:"quota",render:(h,D,l)=>e.jsx("div",{children:me(parseInt(h))})},{title:"创建时间",dataIndex:"created_time",render:(h,D,l)=>e.jsx("div",{children:ls(h)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(h,D,l)=>e.jsx("div",{children:h===0?"无":h})},{title:"",dataIndex:"operate",render:(h,D,l)=>e.jsxs("div",{children:[e.jsx(lu,{content:D.key,style:{padding:20},position:"top",children:e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async w=>{await X(D.key)},children:"复制"}),e.jsx(we,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{ue(D.id,"delete",D).then(()=>{q(D.key)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),D.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{ue(D.id,"disable",D)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{ue(D.id,"enable",D)},disabled:D.status===3,children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{z(D),K(!0)},disabled:D.status!==1,children:"编辑"})]})}],[n,o]=t.useState([]),[s,i]=t.useState(!0),[a,p]=t.useState(1),[A,v]=t.useState(""),[F,c]=t.useState(!1),[m,C]=t.useState(he),[g,I]=t.useState([]),[P,z]=t.useState({id:void 0}),[k,K]=t.useState(!1),G=()=>{K(!1)},Y=h=>{o(h),h.length>=a*he?C(h.length+1):C(h.length)},V=async h=>{const D=await M.get(`/api/redemption/?p=${h}`),{success:l,message:w,data:r}=D.data;if(l)if(h===0)Y(r);else{let x=n;x.push(...r),Y(x)}else y(w);i(!1)},q=h=>{let D=[...n];if(h!=null){let l=D.findIndex(w=>w.key===h);l>-1&&(D.splice(l,1),o(D))}},X=async h=>{await ze(h)?Q("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:h})};t.useEffect(()=>{V(0).then().catch(h=>{y(h)})},[]);const te=async()=>{await V(a-1)},ue=async(h,D,l)=>{let w={id:h},r;switch(D){case"delete":r=await M.delete(`/api/redemption/${h}/`);break;case"enable":w.status=1,r=await M.put("/api/redemption/?status_only=true",w);break;case"disable":w.status=2,r=await M.put("/api/redemption/?status_only=true",w);break}const{success:x,message:j}=r.data;if(x){Q("操作成功完成！");let R=r.data.data,J=[...n];D==="delete"||(l.status=R.status),o(J)}else y(j)},S=async()=>{if(A===""){await V(0),p(1);return}c(!0);const h=await M.get(`/api/redemption/search?keyword=${A}`),{success:D,message:l,data:w}=h.data;D?(o(w),p(1)):y(l),c(!1)},d=async h=>{v(h.trim())},E=h=>{p(h),h===Math.ceil(n.length/he)+1&&V(h-1).then(D=>{})};let $=n.slice((a-1)*he,a*he);const f={onSelect:(h,D)=>{},onSelectAll:(h,D)=>{},onChange:(h,D)=>{I(D)}},b=(h,D)=>h.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(is,{refresh:te,editingRedemption:P,visiable:k,handleClose:G}),e.jsx(N,{onSubmit:S,children:e.jsx(N.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:A,loading:F,onChange:d})}),e.jsx(uu,{style:{marginTop:20},columns:u,dataSource:$,pagination:{currentPage:a,pageSize:he,total:m,formatPageText:h=>`第 ${h.currentStart} - ${h.currentEnd} 条，共 ${n.length} 条`,onPageChange:E},loading:s,rowSelection:f,onRow:b}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{z({id:void 0}),K(!0)},children:"添加兑换码"}),e.jsx(T,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(g.length===0){y("请至少选择一个兑换码！");return}let h="";for(let D=0;D<g.length;D++)h+=g[D].name+"    "+g[D].key+`
`;await X(h)},children:"复制所选兑换码到剪贴板"})]})},ds=()=>e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(ie.Content,{children:e.jsx(cs,{})})]})}),hs=()=>{const[u,n]=t.useState(""),[o,s]=t.useState(""),[i,a]=t.useState(0);t.useState(1);const[p,A]=t.useState(0),[v,F]=t.useState(1),[c,m]=t.useState(""),[C,g]=t.useState(!1),[I,P]=t.useState(0),[z,k]=t.useState(!1),[K,G]=t.useState(!1),[Y,V]=t.useState(""),q=async()=>{if(u===""){Be("请输入兑换码！");return}k(!0);try{const f=await M.post("/api/user/topup",{key:u}),{success:b,message:h,data:D}=f.data;b?(Q("兑换成功！"),fe.success({title:"兑换成功！",content:"成功兑换额度："+me(D),centered:!0}),P(l=>l+D),n("")):y(h)}catch{y("请求失败")}finally{k(!1)}},X=()=>{if(!c){y("超级管理员未设置充值链接！");return}window.open(c,"_blank")},te=async f=>{if(!C){y("管理员未开启在线充值！");return}if(await E(),i<v){y("充值数量不能小于"+v);return}V(f),G(!0)},ue=async()=>{if(p===0&&await E(),i<v){y("充值数量不能小于"+v);return}G(!1);try{const f=await M.post("/api/user/pay",{amount:parseInt(i),top_up_code:o,payment_method:Y});if(f!==void 0){const{message:b,data:h}=f.data;if(b==="success"){let D=h,l=f.data.url,w=document.createElement("form");w.action=l,w.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(w.target="_blank");for(let x in D){let j=document.createElement("input");j.type="hidden",j.name=x,j.value=D[x],w.appendChild(j)}document.body.appendChild(w),w.submit(),document.body.removeChild(w)}else y(h)}else y(f)}catch(f){console.log(f)}finally{}},S=async()=>{let f=await M.get("/api/user/self");const{success:b,message:h,data:D}=f.data;b?P(D.quota):y(h)};t.useEffect(()=>{let f=localStorage.getItem("status");f&&(f=JSON.parse(f),f.top_up_link&&m(f.top_up_link),f.min_topup&&F(f.min_topup),f.enable_online_topup&&g(f.enable_online_topup)),S().then()},[]);const d=()=>p+"元",E=async f=>{f===void 0&&(f=i);try{const b=await M.post("/api/user/amount",{amount:parseFloat(f),top_up_code:o});if(b!==void 0){const{message:h,data:D}=b.data;h==="success"?A(parseFloat(D)):(A(0),Te.error({content:"错误："+D,id:"getAmount"}))}else y(b)}catch(b){console.log(b)}finally{}},$=()=>{G(!1)};return e.jsx("div",{children:e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(ie.Content,{children:[e.jsxs(fe,{title:"确定要充值吗",visible:K,onOk:ue,onCancel:$,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",i]}),e.jsxs("p",{children:["实付金额：",d()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(be,{style:{width:"500px",padding:"20px"},children:[e.jsxs(eu,{level:3,style:{textAlign:"center"},children:["余额 ",me(I)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(yu,{children:"兑换余额"}),e.jsxs(N,{children:[e.jsx(N.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:f=>{n(f)}}),e.jsxs(de,{children:[c?e.jsx(T,{type:"primary",theme:"solid",onClick:X,children:"获取兑换码"}):null,e.jsx(T,{type:"warning",theme:"solid",onClick:q,disabled:z,children:z?"兑换中...":"兑换"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(yu,{children:"在线充值"}),e.jsxs(N,{children:[e.jsx(N.Input,{disabled:!C,field:"redemptionCount",label:"实付金额："+d(),placeholder:"充值数量，最低 "+mn(v),name:"redemptionCount",type:"number",value:i,onChange:async f=>{f<1&&(f=1),a(f),await E(f)}}),e.jsxs(de,{children:[e.jsx(T,{type:"primary",theme:"solid",onClick:async()=>{te("zfb")},children:"支付宝"}),e.jsx(T,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{te("wx")},children:"微信"})]})]})]})]})})]})]})})},{Header:Fs}=ie,Yu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function ps(u){switch(u){case 1:return e.jsxs(L,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs(L,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs(L,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs(L,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs(L,{color:"black",size:"large",children:[" ","未知"," "]})}}function ms(u){return u?e.jsx(L,{color:"blue",size:"large",children:"流"}):e.jsx(L,{color:"purple",size:"large",children:"非流"})}function gs(u){const n=parseInt(u);return n<101?e.jsxs(L,{color:"green",size:"large",children:[" ",n," s"," "]}):n<300?e.jsxs(L,{color:"orange",size:"large",children:[" ",n," s"," "]}):e.jsxs(L,{color:"red",size:"large",children:[" ",n," s"," "]})}const xs=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:ke()?"tableShow":"tableHiddle",render:(B,W,ee)=>k?W.type===0||W.type===2?e.jsx("div",{children:e.jsxs(L,{color:Yu[parseInt(B)%Yu.length],size:"large",children:[" ",B," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:ke()?"tableShow":"tableHiddle",render:(B,W,ee)=>k?e.jsxs("div",{children:[e.jsx(zu,{size:"small",color:cu(B),style:{marginRight:4},onClick:()=>D(W.user_id),children:typeof B=="string"&&B.slice(0,1)}),B]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(B,W,ee)=>W.type===0||W.type===2?e.jsx("div",{children:e.jsxs(L,{color:"grey",size:"large",onClick:()=>{J(B)},children:[" ",B," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(B,W,ee)=>e.jsx("div",{children:ps(B)})},{title:"模型",dataIndex:"model_name",render:(B,W,ee)=>W.type===0||W.type===2?e.jsx("div",{children:e.jsxs(L,{color:cu(B),size:"large",onClick:()=>{J(B)},children:[" ",B," "]})}):e.jsx(e.Fragment,{})},{title:"用时",dataIndex:"use_time",render:(B,W,ee)=>e.jsx("div",{children:e.jsxs(de,{children:[gs(B),ms(W.is_stream)]})})},{title:"提示",dataIndex:"prompt_tokens",render:(B,W,ee)=>W.type===0||W.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",B," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(B,W,ee)=>parseInt(B)>0&&(W.type===0||W.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",B," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(B,W,ee)=>W.type===0||W.type===2?e.jsx("div",{children:me(B,6)}):e.jsx(e.Fragment,{})},{title:"重试",dataIndex:"retry",className:ke()?"tableShow":"tableHiddle",render:(B,W,ee)=>{let le="渠道："+W.channel;if(W.other!==""){let ae=JSON.parse(W.other);if(ae===null)return e.jsx(e.Fragment,{});ae.admin_info!==void 0&&ae.admin_info.use_channel!==null&&ae.admin_info.use_channel!==void 0&&ae.admin_info.use_channel!==""&&(le=`渠道：${ae.admin_info.use_channel.join("->")}`)}return k?e.jsx("div",{children:le}):e.jsx(e.Fragment,{})}},{title:"详情",dataIndex:"content",render:(B,W,ee)=>{W.other===""&&(W.other="{}");let le=JSON.parse(W.other);if(le==null)return e.jsx(Wu,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:B});let ae=gn(W.prompt_tokens,W.completion_tokens,le.model_ratio,le.model_price,le.completion_ratio,le.group_ratio);return e.jsx(Pe,{content:ae,children:e.jsx(Wu,{ellipsis:{rows:2},style:{maxWidth:240},children:B})})}}],[n,o]=t.useState([]),[s,i]=t.useState(!1),[a,p]=t.useState(!1),[A,v]=t.useState(!1),[F,c]=t.useState(1),[m,C]=t.useState(he),[g,I]=t.useState(he);t.useState(""),t.useState(!1);const[P,z]=t.useState(0),k=ke();let K=new Date;const[G,Y]=t.useState({username:"",token_name:"",model_name:"",start_timestamp:Le(K.getTime()/1e3-86400),end_timestamp:Le(K.getTime()/1e3+3600),channel:""}),{username:V,token_name:q,model_name:X,start_timestamp:te,end_timestamp:ue,channel:S}=G,[d,E]=t.useState({quota:0,token:0}),$=(B,W)=>{Y(ee=>({...ee,[W]:B}))},f=async()=>{let B=Date.parse(te)/1e3,W=Date.parse(ue)/1e3,ee=await M.get(`/api/log/self/stat?type=${P}&token_name=${q}&model_name=${X}&start_timestamp=${B}&end_timestamp=${W}`);const{success:le,message:ae,data:oe}=ee.data;le?E(oe):y(ae)},b=async()=>{let B=Date.parse(te)/1e3,W=Date.parse(ue)/1e3,ee=await M.get(`/api/log/stat?type=${P}&username=${V}&token_name=${q}&model_name=${X}&start_timestamp=${B}&end_timestamp=${W}&channel=${S}`);const{success:le,message:ae,data:oe}=ee.data;le?E(oe):y(ae)},h=async()=>{v(!0),k?await b():await f(),i(!0),v(!1)},D=async B=>{if(!k)return;const W=await M.get(`/api/user/${B}`),{success:ee,message:le,data:ae}=W.data;ee?fe.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",ae.username]}),e.jsxs("p",{children:["余额: ",me(ae.quota)]}),e.jsxs("p",{children:["已用额度：",me(ae.used_quota)]}),e.jsxs("p",{children:["请求次数：",Bu(ae.request_count)]})]}),centered:!0}):y(le)},l=B=>{for(let W=0;W<B.length;W++)B[W].timestamp2string=Le(B[W].created_at),B[W].key=""+B[W].id;o(B),C(B.length+he)},w=async(B,W,ee=0)=>{p(!0);let le="",ae=Date.parse(te)/1e3,oe=Date.parse(ue)/1e3;k?le=`/api/log/?p=${B}&page_size=${W}&type=${ee}&username=${V}&token_name=${q}&model_name=${X}&start_timestamp=${ae}&end_timestamp=${oe}&channel=${S}`:le=`/api/log/self/?p=${B}&page_size=${W}&type=${ee}&token_name=${q}&model_name=${X}&start_timestamp=${ae}&end_timestamp=${oe}`;const Ae=await M.get(le),{success:_e,message:$e,data:Re}=Ae.data;if(_e)if(B===0)l(Re);else{let tu=[...n];tu.splice(B*W,Re.length,...Re),l(tu)}else y($e);p(!1)},r=n.slice((F-1)*g,F*g),x=B=>{c(B),B===Math.ceil(n.length/g)+1&&w(B-1,g,P).then(W=>{})},j=async B=>{localStorage.setItem("page-size",B+""),I(B),c(1),w(0,B).then().catch(W=>{y(W)})},R=async()=>{c(1),await w(0,g,P)},J=async B=>{await ze(B)?Q("已复制："+B):fe.error({title:"无法复制到剪贴板，请手动复制",content:B})};return t.useEffect(()=>{const B=parseInt(localStorage.getItem("page-size"))||he;I(B),w(0,B).then().catch(W=>{y(W)})},[]),e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(Fs,{children:e.jsx(De,{spinning:A,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:h,style:{cursor:"pointer",color:"gray"},children:s?me(d.quota):"点击查看"}),"）"]})})}),e.jsx(N,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:q,placeholder:"可选值",name:"token_name",onChange:B=>$(B,"token_name")}),e.jsx(N.Input,{field:"model_name",label:"模型名称",style:{width:176},value:X,placeholder:"可选值",name:"model_name",onChange:B=>$(B,"model_name")}),e.jsx(N.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:te,value:te,type:"dateTime",name:"start_timestamp",onChange:B=>$(B,"start_timestamp")}),e.jsx(N.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:ue,value:ue,type:"dateTime",name:"end_timestamp",onChange:B=>$(B,"end_timestamp")}),k&&e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:S,placeholder:"可选值",name:"channel",onChange:B=>$(B,"channel")}),e.jsx(N.Input,{field:"username",label:"用户名称",style:{width:176},value:V,placeholder:"可选值",name:"username",onChange:B=>$(B,"username")})]}),e.jsx(N.Section,{children:e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:R,loading:a,children:"查询"})})]})}),e.jsx(uu,{style:{marginTop:5},columns:u,dataSource:r,pagination:{currentPage:F,pageSize:g,total:m,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:B=>{j(B).then()},onPageChange:x}}),e.jsxs(Ie,{defaultValue:"0",style:{width:120},onChange:B=>{z(parseInt(B)),w(0,g,parseInt(B))},children:[e.jsx(Ie.Option,{value:"0",children:"全部"}),e.jsx(Ie.Option,{value:"1",children:"充值"}),e.jsx(Ie.Option,{value:"2",children:"消费"}),e.jsx(Ie.Option,{value:"3",children:"管理"}),e.jsx(Ie.Option,{value:"4",children:"系统"})]})]})})},Es=()=>e.jsx(e.Fragment,{children:e.jsx(xs,{})}),Cs=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},Zu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function fs(u){switch(u){case"IMAGINE":return e.jsx(L,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx(L,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx(L,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx(L,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx(L,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx(L,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx(L,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx(L,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx(L,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx(L,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx(L,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx(L,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx(L,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx(L,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx(L,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx(L,{color:"white",size:"large",children:"未知"})}}function js(u){switch(u){case 1:return e.jsx(L,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx(L,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx(L,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx(L,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx(L,{color:"white",size:"large",children:"未知"})}}function ys(u){switch(u){case"SUCCESS":return e.jsx(L,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx(L,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx(L,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx(L,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx(L,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx(L,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx(L,{color:"white",size:"large",children:"未知"})}}const Ds=u=>{const n=new Date(u*1e3),o=n.getFullYear(),s=("0"+(n.getMonth()+1)).slice(-2),i=("0"+n.getDate()).slice(-2),a=("0"+n.getHours()).slice(-2),p=("0"+n.getMinutes()).slice(-2),A=("0"+n.getSeconds()).slice(-2);return`${o}-${s}-${i} ${a}:${p}:${A}`};function Bs(u,n){if(!u||!n)return"N/A";const o=new Date(u),a=((new Date(n)-o)/1e3).toFixed(1),p=a>60?"red":"green";return e.jsxs(L,{color:p,size:"large",children:[a," 秒"]})}const As=()=>{const[u,n]=t.useState(!1),[o,s]=t.useState(""),i=[{title:"提交时间",dataIndex:"submit_time",render:(r,x,j)=>e.jsx("div",{children:Ds(r/1e3)})},{title:"花费时间",dataIndex:"finish_time",key:"finish_time",render:(r,x)=>Bs(x.submit_time,r)},{title:"渠道",dataIndex:"channel_id",className:ke()?"tableShow":"tableHiddle",render:(r,x,j)=>e.jsx("div",{children:e.jsxs(L,{color:Zu[parseInt(r)%Zu.length],size:"large",onClick:()=>{w(r)},children:[" ",r," "]})})},{title:"类型",dataIndex:"action",render:(r,x,j)=>e.jsx("div",{children:fs(r)})},{title:"任务ID",dataIndex:"mj_id",render:(r,x,j)=>e.jsx("div",{children:r})},{title:"提交结果",dataIndex:"code",className:ke()?"tableShow":"tableHiddle",render:(r,x,j)=>e.jsx("div",{children:js(r)})},{title:"任务状态",dataIndex:"status",className:ke()?"tableShow":"tableHiddle",render:(r,x,j)=>e.jsx("div",{children:ys(r)})},{title:"进度",dataIndex:"progress",render:(r,x,j)=>e.jsx("div",{children:e.jsx(Mt,{stroke:x.status==="FAILURE"?"var(--semi-color-warning)":null,percent:r?parseInt(r.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(r,x,j)=>r?e.jsx(T,{onClick:()=>{V(r),k(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(r,x,j)=>r?e.jsx(Z.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(r),n(!0)},children:r}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(r,x,j)=>r?e.jsx(Z.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(r),n(!0)},children:r}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(r,x,j)=>r?e.jsx(Z.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(r),n(!0)},children:r}):"无"}],[a,p]=t.useState([]),[A,v]=t.useState(!0),[F,c]=t.useState(1),[m,C]=t.useState(he),[g,I]=t.useState(0),P=ke(),[z,k]=t.useState(!1),[K,G]=t.useState(!1),[Y,V]=t.useState("");let q=new Date;const[X,te]=t.useState({channel_id:"",mj_id:"",start_timestamp:Le(q.getTime()/1e3-2592e3),end_timestamp:Le(q.getTime()/1e3+3600)}),{channel_id:ue,mj_id:S,start_timestamp:d,end_timestamp:E}=X;t.useState({quota:0,token:0});const $=(r,x)=>{te(j=>({...j,[x]:r}))},f=r=>{for(let x=0;x<r.length;x++)r[x].timestamp2string=Le(r[x].created_at),r[x].key=""+r[x].id;p(r),C(r.length+he)},b=async r=>{v(!0);let x="",j=Date.parse(d),R=Date.parse(E);P?x=`/api/mj/?p=${r}&channel_id=${ue}&mj_id=${S}&start_timestamp=${j}&end_timestamp=${R}`:x=`/api/mj/self/?p=${r}&mj_id=${S}&start_timestamp=${j}&end_timestamp=${R}`;const J=await M.get(x),{success:B,message:W,data:ee}=J.data;if(B)if(r===0)f(ee);else{let le=[...a];le.splice(r*he,ee.length,...ee),f(le)}else y(W);v(!1)},h=a.slice((F-1)*he,F*he),D=r=>{c(r),r===Math.ceil(a.length/he)+1&&b(r-1).then(x=>{})},l=async()=>{c(1),await b(0)},w=async r=>{await ze(r)?Q("已复制："+r):fe.error({title:"无法复制到剪贴板，请手动复制",content:r})};return t.useEffect(()=>{l().then()},[g]),t.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&G(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[P&&K?e.jsx(Ue,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(N,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:ue,placeholder:"可选值",name:"channel_id",onChange:r=>$(r,"channel_id")}),e.jsx(N.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:S,placeholder:"可选值",name:"mj_id",onChange:r=>$(r,"mj_id")}),e.jsx(N.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:d,value:d,type:"dateTime",name:"start_timestamp",onChange:r=>$(r,"start_timestamp")}),e.jsx(N.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:E,value:E,type:"dateTime",name:"end_timestamp",onChange:r=>$(r,"end_timestamp")}),e.jsx(N.Section,{children:e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:l,children:"查询"})})]})}),e.jsx(uu,{style:{marginTop:5},columns:i,dataSource:h,pagination:{currentPage:F,pageSize:he,total:m,pageSizeOpts:[10,20,50,100],onPageChange:D},loading:A}),e.jsx(fe,{visible:u,onOk:()=>n(!1),onCancel:()=>n(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:o})}),e.jsx(tt,{src:Y,visible:z,onVisibleChange:r=>k(r)})]})})},bs=()=>e.jsx(e.Fragment,{children:e.jsx(As,{})});function Ss(u){switch(u){case 1:return e.jsx(L,{color:"teal",size:"large",children:"按次计费"});case 0:return e.jsx(L,{color:"violet",size:"large",children:"按量计费"});default:return"未知"}}function ws(u){return u?e.jsx(lu,{content:e.jsx("div",{style:{padding:8},children:"您的分组可以使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx($t,{style:{color:"green"},size:"large"})},u):e.jsx(lu,{content:e.jsx("div",{style:{padding:8},children:"您的分组无权使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(Rt,{style:{color:"#FFA54F"},size:"large"})},u)}const vs=()=>{const[u,n]=t.useState([]),o=t.useRef({isComposition:!1}),[s,i]=t.useState([]),[a,p]=t.useState(""),[A,v]=t.useState(!1),F=t.useMemo(()=>({onChange:(S,d)=>{i(S)}}),[]),c=S=>{if(o.current.isComposition)return;n(S?[S]:[])},m=()=>{o.current.isComposition=!0},C=S=>{o.current.isComposition=!1;const d=S.target.value;n(d?[d]:[])},g=[{title:"可用性",dataIndex:"available",render:(S,d,E)=>ws(S),sorter:(S,d)=>S.available-d.available},{title:e.jsxs(de,{children:[e.jsx("span",{children:"模型名称"}),e.jsx(se,{placeholder:"模糊搜索",style:{width:200},onCompositionStart:m,onCompositionEnd:C,onChange:c,showClear:!0})]}),dataIndex:"model_name",render:(S,d,E)=>e.jsx(e.Fragment,{children:e.jsx(L,{color:"green",size:"large",onClick:()=>{ue(S)},children:S})}),onFilter:(S,d)=>d.model_name.toLowerCase().includes(S.toLowerCase()),filteredValue:u},{title:"计费类型",dataIndex:"quota_type",render:(S,d,E)=>Ss(parseInt(S)),sorter:(S,d)=>S.quota_type-d.quota_type},{title:()=>e.jsxs("span",{style:{display:"flex",alignItems:"center"},children:["倍率",e.jsx(lu,{content:e.jsxs("div",{style:{padding:8},children:["倍率是为了方便换算不同价格的模型",e.jsx("br",{}),"点击查看倍率说明"]}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(nt,{onClick:()=>{p("/ratio.png"),v(!0)}})})]}),dataIndex:"model_ratio",render:(S,d,E)=>{let $=S,f=parseFloat(d.completion_ratio.toFixed(3));return $=e.jsxs(e.Fragment,{children:[e.jsxs(su,{children:["模型：",d.quota_type===0?S:"无"]}),e.jsx("br",{}),e.jsxs(su,{children:["补全：",d.quota_type===0?f:"无"]})]}),e.jsx("div",{children:$})}},{title:"模型价格",dataIndex:"model_price",render:(S,d,E)=>{let $=S;if(d.quota_type===0){let f=d.model_ratio*2*d.group_ratio,b=d.model_ratio*d.completion_ratio*2*d.group_ratio;$=e.jsxs(e.Fragment,{children:[e.jsxs(su,{children:["提示 $",f," / 1M tokens"]}),e.jsx("br",{}),e.jsxs(su,{children:["补全 $",b," / 1M tokens"]})]})}else{let f=parseFloat(S)*d.group_ratio;$=e.jsxs(e.Fragment,{children:["模型价格：$",f]})}return e.jsx("div",{children:$})}}],[I,P]=t.useState([]),[z,k]=t.useState(!0),[K,G]=t.useContext(Je),[Y,V]=t.useState(1),q=(S,d)=>{for(let E=0;E<S.length;E++)S[E].key=S[E].model_name,S[E].group_ratio=d;S.sort((E,$)=>E.quota_type-$.quota_type),S.sort((E,$)=>E.model_name.startsWith("gpt")&&!$.model_name.startsWith("gpt")?-1:!E.model_name.startsWith("gpt")&&$.model_name.startsWith("gpt")?1:E.model_name.localeCompare($.model_name)),P(S)},X=async()=>{k(!0);let S="";S="/api/pricing";const d=await M.get(S),{success:E,message:$,data:f,group_ratio:b}=d.data;E?(V(b),q(f,b)):y($),k(!1)},te=async()=>{await X()},ue=async S=>{await ze(S)?Q("已复制："+S):fe.error({title:"无法复制到剪贴板，请手动复制",content:S})};return t.useEffect(()=>{te().then()},[]),e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[K.user?e.jsx(Ue,{type:"success",fullMode:!1,closeIcon:"null",description:`您的分组为：${K.user.group}，分组倍率为：${Y}`}):e.jsx(Ue,{type:"warning",fullMode:!1,closeIcon:"null",description:`您还未登陆，显示的价格为默认分组倍率: ${Y}`}),e.jsx("br",{}),e.jsx(Ue,{type:"info",fullMode:!1,description:e.jsx("div",{children:"按量计费费用 = 分组倍率 × 模型倍率 × （提示token数 + 补全token数 × 补全倍率）/ 500000 （单位：美元）"}),closeIcon:"null"}),e.jsx("br",{}),e.jsx(T,{theme:"light",type:"tertiary",style:{width:150},onClick:()=>{ue(s)},disabled:s=="",children:"复制选中模型"}),e.jsx(uu,{style:{marginTop:5},columns:g,dataSource:I,loading:z,pagination:{pageSize:I.length,showSizeChanger:!1},rowSelection:F}),e.jsx(tt,{src:a,visible:A,onVisibleChange:S=>v(S)})]})})},ks=()=>e.jsx(e.Fragment,{children:e.jsx(vs,{})}),_s=t.lazy(()=>Nu(()=>import("./index-BcZxoa4C.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ts=t.lazy(()=>Nu(()=>import("./index-B3gkVdNw.js"),__vite__mapDeps([7,1,8,2,3,4,5,6]))),Is=t.lazy(()=>Nu(()=>import("./index-DQO7dzHP.js"),__vite__mapDeps([9,1,4,2,3,5,6])));function Ps(){const[u,n]=t.useContext(Je),o=()=>{let s=localStorage.getItem("user");if(s){let i=JSON.parse(s);n({type:"login",payload:i})}};return t.useEffect(()=>{o();let s=Su();s&&(document.title=s);let i=Fu();if(i){let a=document.querySelector("link[rel~='icon']");a&&(a.href=i)}},[]),e.jsx(ie,{children:e.jsx(ie.Content,{children:e.jsxs(wt,{children:[e.jsx(pe,{path:"/",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(_s,{})})}),e.jsx(pe,{path:"/channel",element:e.jsx(We,{children:e.jsx(ts,{})})}),e.jsx(pe,{path:"/channel/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ru,{})})}),e.jsx(pe,{path:"/channel/add",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ru,{})})}),e.jsx(pe,{path:"/token",element:e.jsx(We,{children:e.jsx(rs,{})})}),e.jsx(pe,{path:"/redemption",element:e.jsx(We,{children:e.jsx(ds,{})})}),e.jsx(pe,{path:"/user",element:e.jsx(We,{children:e.jsx(fn,{})})}),e.jsx(pe,{path:"/user/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx($u,{})})}),e.jsx(pe,{path:"/user/edit",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx($u,{})})}),e.jsx(pe,{path:"/user/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Jn,{})})}),e.jsx(pe,{path:"/login",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(vn,{})})}),e.jsx(pe,{path:"/register",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(jn,{})})}),e.jsx(pe,{path:"/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Vn,{})})}),e.jsx(pe,{path:"/oauth/github",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Qn,{})})}),e.jsx(pe,{path:"/setting",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(qn,{})})})}),e.jsx(pe,{path:"/topup",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(hs,{})})})}),e.jsx(pe,{path:"/log",element:e.jsx(We,{children:e.jsx(Es,{})})}),e.jsx(pe,{path:"/detail",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ts,{})})})}),e.jsx(pe,{path:"/midjourney",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(bs,{})})})}),e.jsx(pe,{path:"/pricing",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ks,{})})}),e.jsx(pe,{path:"/about",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Is,{})})}),e.jsx(pe,{path:"/chat",element:e.jsx(t.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Cs,{})})}),e.jsx(pe,{path:"*",element:e.jsx(kn,{})})]})})})}localStorage.getItem("chat_link");const Ms=()=>{const[u,n]=t.useContext(Je);let o=Me();const[s,i]=t.useState(!1);Su(),Fu();const a=new Date,p=a.getMonth()===0&&a.getDate()===1||a.getMonth()===1&&a.getDate()>=9&&a.getDate()<=24;async function A(){i(!1),await M.get("/api/user/logout"),Q("注销成功!"),n({type:"logout"}),localStorage.removeItem("user"),o("/login")}const v=()=>{ku.init("root",{}),ku.start(),setTimeout(()=>{ku.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)},F=gt(),c=_n();return t.useEffect(()=>{F==="dark"&&document.body.setAttribute("theme-mode","dark"),p&&console.log("Happy New Year!")},[]),e.jsx(e.Fragment,{children:e.jsx(ie,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx(Ze,{mode:"horizontal",renderWrapper:({itemElement:m,isSubNav:C,isInSubNav:g,props:I})=>{const P={about:"/about",login:"/login",register:"/register"};return e.jsx(iu,{style:{textDecoration:"none"},to:P[I.itemKey],children:m})},selectedKeys:[],onSelect:m=>{},footer:e.jsxs(e.Fragment,{children:[p&&e.jsx(He,{position:"bottomRight",render:e.jsx(He.Menu,{children:e.jsx(He.Item,{onClick:v,children:"Happy New Year!!!"})}),children:e.jsx(Ze.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx(Ze.Item,{itemKey:"about",icon:e.jsx(nt,{})}),e.jsx(Iu,{checkedText:"🌞",size:"large",checked:F==="dark",uncheckedText:"🌙",onChange:m=>{c(m)}}),u.user?e.jsx(e.Fragment,{children:e.jsxs(He,{position:"bottomRight",render:e.jsx(He.Menu,{children:e.jsx(He.Item,{onClick:A,children:"退出"})}),children:[e.jsx(zu,{size:"small",color:cu(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Ze.Item,{itemKey:"login",text:"登录",icon:e.jsx(st,{})}),e.jsx(Ze.Item,{itemKey:"register",text:"注册",icon:e.jsx(at,{})})]})]})})})})})},$s=()=>{Su();const[u,n]=t.useState(cn());let o=5;const s=()=>{let a=localStorage.getItem("footer_html");a&&n(a)},i=e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",""," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API"})]});return t.useEffect(()=>{const a=setInterval(()=>{if(o<=0){clearInterval(a);return}o--,s()},200);return()=>clearTimeout(a)},[]),e.jsx(ie,{children:e.jsx(ie.Content,{style:{textAlign:"center"},children:u?e.jsx(Pe,{content:i,children:e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}})}):i})})},Rs=(u,n)=>{switch(n.type){case"set":return{...u,status:n.payload};case"unset":return{...u,status:void 0};default:return u}},Ct={status:void 0},ft=du.createContext({state:Ct,dispatch:()=>null}),Os=({children:u})=>{const[n,o]=du.useReducer(Rs,Ct);return e.jsx(ft.Provider,{value:[n,o],children:u})},zs=()=>{t.useContext(Je);const[u,n]=t.useContext(ft),o=ve()||localStorage.getItem("default_collapse_sidebar")==="true";Me();const[s,i]=t.useState(["home"]),a=Su(),p=Fu(),[A,v]=t.useState(o),F={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail",pricing:"/pricing"},c=t.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx(Ot,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx(zt,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(Lt,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(st,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(Nt,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(Wt,{})},{text:"模型价格",itemKey:"pricing",to:"/pricing",icon:e.jsx(Ut,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(at,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(Kt,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(Gt,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(Ht,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(qt,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("chat_link"),ke()]),m=async()=>{const C=await M.get("/api/status");if(C===void 0)return;const{success:g,data:I}=C.data;g?(n({type:"set",payload:I}),Sn(I)):y("无法正常连接至服务器！")};return t.useEffect(()=>{m().then(()=>{v(ve()||localStorage.getItem("default_collapse_sidebar")==="true")});let C=window.location.pathname.split("/")[1];C===""&&(C="home"),i([C])},[]),e.jsx(e.Fragment,{children:e.jsx(ie,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx(Ze,{style:{maxWidth:200},defaultIsCollapsed:ve()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:A,onCollapseChange:C=>{v(C)},selectedKeys:s,renderWrapper:({itemElement:C,isSubNav:g,isInSubNav:I,props:P})=>e.jsx(iu,{style:{textDecoration:"none"},to:F[P.itemKey],children:C}),items:c,onSelect:C=>{i([C.itemKey])},header:{logo:e.jsx("img",{src:p,alt:"logo",style:{marginRight:"0.75em"}}),text:a},children:e.jsx(Ze.Footer,{collapseButton:!0})})})})})},Ls=Mu.createRoot(document.getElementById("root")),{Sider:Ns,Content:Ws,Header:Us}=ie;Ls.render(e.jsx(du.StrictMode,{children:e.jsx(Os,{children:e.jsx(Dn,{children:e.jsx(vt,{children:e.jsx(Tn,{children:e.jsxs(ie,{children:[e.jsx(Ns,{children:e.jsx(zs,{})}),e.jsxs(ie,{children:[e.jsx(Us,{children:e.jsx(Ms,{})}),e.jsx(Ws,{style:{padding:"24px"},children:e.jsx(Ps,{})}),e.jsx(ie.Footer,{children:e.jsx($s,{})})]}),e.jsx(Jt,{})]})})})})})}));export{M as A,ft as S,y as a,Bu as b,Qs as c,me as d,Ys as g,ke as i,e as j,Zs as m,Js as r,Gu as s,Le as t};
